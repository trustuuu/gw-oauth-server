{"version":3,"file":"server.js","mappings":"IAAIA,EACAC,EACAC,EACAC,E,sDCAJ,MAAMC,EAAoB,WAC1B,IAEMC,EAAU,cAwHhB,SAASC,EAAIC,EAAUC,EAAIC,EAASC,EAAOC,GACzC,OAAOH,IACJI,MAAMC,GACLN,EACGO,OAAO,KACPC,KAAKJ,IAAcF,EAAUA,EAAQI,GAAUA,MAEnDG,OAAOC,IACNC,QAAQR,MAAMO,GACPV,EAASO,OAAO,KAAKC,KAAKL,EAAQA,EAAMO,GAAOA,KAE5D,CAjIAb,EAAkBe,IAAI,IAAId,MAAY,CAACe,EAAKC,KACtCD,EAAIE,MAAMC,UACZjB,EAAIe,GAAK,IACP,IAAmBG,qBACjBnB,EACA,KACA,KACAe,EAAIE,MAAMC,aAIdjB,EAAIe,GAAK,IAAM,IAAmBI,QAAQpB,IAC5C,IAGFD,EAAkBe,IAAI,IAAId,SAAe,CAACe,EAAKC,KAC7Cf,EAAIe,GAAK,IAAM,IAAmBI,QAAQpB,EAASe,EAAIM,OAAOC,KAAI,IAGpEvB,EAAkBe,IAAI,2BAA2B,CAACC,EAAKC,KACjDD,EAAIE,MAAMC,UACZjB,EAAIe,GAAK,IACP,IAAmBG,qBACjBnB,EACAe,EAAIM,OAAOE,UACX,KACAR,EAAIE,MAAMC,aAIdjB,EAAIe,GAAK,IACP,IAAmBQ,gBAAgBxB,EAASe,EAAIM,OAAOE,YAE3D,IAGFxB,EAAkBe,IAAI,qCAAqC,CAACC,EAAKC,KAC3DD,EAAIE,MAAMC,UACZjB,EAAIe,GAAK,IACP,IAAmBG,qBACjBnB,EACAe,EAAIM,OAAOE,UACXR,EAAIM,OAAOI,SACXV,EAAIE,MAAMC,aAIdjB,EAAIe,GAAK,IACP,IAAmBQ,gBACjBxB,EACAe,EAAIM,OAAOE,UACXR,EAAIM,OAAOI,WAGjB,IAGF1B,EAAkB2B,KAAK,IAAI1B,MAAY,CAACe,EAAKC,KAC3C,MAAMV,EAAO,IACRS,EAAIY,KACPC,qBAAsB,IAAIC,KAC1BC,cAAe,OAEjB7B,EACEe,GACA,IACE,IAAmBe,QAAQC,MACzB,IACA,CAAC1B,GAAM2B,OAAO,CAACjC,EAASM,EAAK4B,mBAEjCC,OACAA,EACA7B,EACD,IAGHP,EAAkBqC,IAAI,IAAIpC,KAAW,CAACe,EAAKC,KACzC,MAAMV,EAAO,IAAKS,EAAIY,KAAMU,YAAa,IAAIR,KAAQpB,OAAQ,WAC7DR,EAAIe,GAAK,IACP,IAAmBsB,WAAWN,MAC5B,IACA,CAAC1B,GAAM2B,OAAO,CAACjC,EAASM,EAAKgB,OAEhC,IAGHvB,EAAkBqC,IAAI,IAAIpC,SAAe,CAACe,EAAKC,KAC7C,MAAMV,EAAO,IAAKS,EAAIY,KAAMU,YAAa,IAAIR,KAAQpB,OAAQ,WAC7DR,EAAIe,GAAK,IACP,IAAmBsB,WAAWN,MAC5B,IACA,CAAC1B,GAAM2B,OAAO,CAACjC,EAASe,EAAIM,OAAOC,OAEtC,IAGHvB,EAAkBwC,OAAO,IAAIvC,SAAe,CAACe,EAAKC,KAChD,MAAMV,EAAO,CAAC,EACdL,EAAIe,GAAK,IACP,IAAmBwB,WAAWR,MAC5B,IACA,CAAC1B,GAAM2B,OAAO,CAACjC,EAASe,EAAIM,OAAOC,OAEtC,IAGHvB,EAAkBwC,OAAO,IAAIvC,KAAW,CAACe,EAAKC,KAC5C,MACMyB,EADO,IAAI1B,EAAIY,MACGe,KAAKC,GACpB,IAAmBH,WAAWR,MACnC,IACA,CAAC,MAAMC,OAAO,CAACjC,EAAS2C,EAAKrB,QAGjCrB,EAAIe,GAAK,IAAM4B,QAAQC,IAAIJ,IAAY,G,QC1HzCK,EAAOC,QAAUC,QAAQ,O,sDCGzB,SAAe,E,OAAA,GAAc,MCIvBC,EAAqB,WAC3B,IAwEA,SAAShD,EAAIC,EAAUC,EAAIC,EAASC,EAAOC,GACzC,OAAOH,IACJI,MAAMC,GACLN,EACGO,OAAO,KACPC,KAAKJ,IAAcF,EAAUA,EAAQI,GAAUA,MAEnDG,OAAOC,IACNC,QAAQR,MAAMO,GACPV,EAASO,OAAO,KAAKC,KAAKL,EAAQA,EAAMO,GAAOA,KAE5D,CAjFAqC,EAAmBnC,IACjB,QAAQ,wBACR,CAACC,EAAKC,KACJf,EAAIe,GAAK,IACP,EAAoBI,QAAQL,EAAIM,OAAOC,GAAIP,EAAIM,OAAO6B,iBACvD,IAILD,EAAmBnC,IAAI,QAAQ,QAAqB,CAACC,EAAKC,KACxDf,EAAIe,GAAK,IAAM,EAAoBI,QAAQL,EAAIM,OAAOC,KAAI,IAG5D2B,EAAmBvB,KAAK,QAAQ,QAAqByB,MAAOpC,EAAKC,KAC/D,MAAMV,EAAO,IACRS,EAAIY,KACPL,IAAI,QAAWP,EAAIY,KAAKyB,MACxBC,YAAa,IAAIxB,KACjBpB,OAAQ,OAGJ6C,QAAqB,EAAoBlC,QAC7CL,EAAIM,OAAOC,GACXhB,EAAKgB,IAEP,GAAIgC,EAAaF,KAEf,OADAvC,QAAQ0C,IAAI,qBAAsBD,GAC3BtC,EAAIP,OAAO,KAAKC,KAAK,eAG9BT,EACEe,GACA,IACE,EAAoBe,QAAQC,MAC1B,EACA,CAAC1B,GAAM2B,OAAO,CAAClB,EAAIM,OAAOC,GAAIhB,EAAKgB,YAEvCa,OACAA,EACA7B,EACD,IAGH2C,EAAmBb,IACjB,QAAQ,wBACR,CAACrB,EAAKC,KACJ,MAAMV,EAAO,IAAKS,EAAIY,KAAMU,YAAa,IAAIR,KAAQpB,OAAQ,WAC7DR,EAAIe,GAAK,IACP,EAAoBsB,WAAWN,MAC7B,EACA,CAAC1B,GAAM2B,OAAO,CAAClB,EAAIM,OAAOC,GAAIP,EAAIM,OAAO6B,mBAE5C,IAILD,EAAmBV,OACjB,QAAQ,wBACR,CAACxB,EAAKC,KACJ,MAAMV,EAAO,CAAC,EACdL,EAAIe,GAAK,IACP,EAAoBwB,WAAWR,MAC7B,EACA,CAAC1B,GAAM2B,OAAO,CAAClB,EAAIM,OAAOC,GAAIP,EAAIM,OAAO6B,mBAE5C,G,SC3ELJ,EAAOC,QAAUC,QAAQ,S,0ECAzB,MAAM,EAA+BA,QAAQ,a,aCA7C,MAAM,EAA+BA,QAAQ,eCAvC,EAA+BA,QAAQ,cCAvC,EAA+BA,QAAQ,qB,4oDCShCQ,EAAsB,CAACC,EAAKC,EAAKC,EAAKC,EAAKC,EAAKC,KACzD,IAAIC,EAAS,CAAE,IAAO,MAAO,IAAO,MAAY,IAAO,OACnDC,EAAU,CACVP,IAAKA,EACLC,IAAKA,EACLC,IAAKA,EACLC,IAAKA,EACLC,IAAKA,EACLI,IAAK,WAAsB,GAC3BH,YAAaA,GAGbI,EAAa,UAAaC,OAAO,GAMrC,OALmB,MAASC,IAAIC,KAAKN,EAAOO,IACxCC,KAAKC,UAAUT,GACfQ,KAAKC,UAAUR,GACfE,EAEe,EAGVO,EAAW,CAACC,EAAMC,EAASC,KACvC,IAAIC,EAAS,QAAUH,GAAM,GAY7B,cAXOG,EAAOC,OACTD,EAAO5D,QACX4D,EAAO5D,MAAQ,CAAC,GAEjB,OAAQ0D,GAAS,SAASI,EAAOC,GAChCH,EAAO5D,MAAM+D,GAAOD,CACrB,IACIH,IACHC,EAAOD,KAAOA,GAGR,SAAWC,EAAO,EAGbI,EAA0B,SAASC,GAC/C,IAAIC,EAAoBC,OAAOC,KAAKH,EAAKI,MAAM,GAAkB,UAAUC,WAAWC,MAAM,KAG5F,MAAO,CAAElE,GAFM,WAAqB6D,EAAkB,IAE/BM,OADJ,WAAqBN,EAAkB,IAE3D,EAEaO,EAAoB,SAAS/D,GACzC,OAAO,SAAU,OAAQA,IAAO,SAASgE,GAAK,OAAO,aAAoBA,EAAG,SAAW,IACnFjD,KAAI,SAASiD,GAAK,OAAOA,EAAEL,MAAM,EAAkB,GACxD,C,uDC7CO,MAAMM,EAAiBC,IAC5BhF,QAAQ0C,IAAI,SAAUsC,EAAQA,KACvB,CACLC,QAASD,EACTzE,QAAS,UAAU,KAAQyE,GAC3BE,aAAc,UAAU,KAAaF,GACrCG,aAAc,UAAU,KAAoBH,GAC5C9D,QAAS,CAACzB,KAAS2F,KAAQ,QAAOJ,EAAO7D,MAAM,KAAMiE,GAAM3F,GAC3D4F,QAAS,CAAC5F,KAAS2F,KAAQ,QAAOJ,EAAO7D,MAAM,KAAMiE,GAAM3F,GAC3DgC,WAAY,CAAChC,KAAS2F,KAAQ,QAAUJ,EAAO7D,MAAM,KAAMiE,GAAM3F,GACjEkC,WAAY,CAAClC,KAAS2F,KAAQ,QAAUJ,EAAO7D,MAAM,KAAMiE,GAAM3F,GACjE6F,cAAgBC,IAAa,QAAOA,GACpCC,cAAe,CAACD,EAAU9F,KAAS,QAAO8F,EAAU9F,GACpDgG,iBAAmBF,IAAa,QAAUA,I,UCxB9CtD,EAAOC,QAAUC,QAAQ,c,UCAzBF,EAAOC,QAAUC,QAAQ,e,UCAzBF,EAAOC,QAAUC,QAAQ,0B,UCAzBF,EAAOC,QAAUC,QAAQ,U,kSCazB,WAYA,MAAMuD,GAAe,EACfC,GAAa,IAAAC,eAAc,qDAC3BC,EAAY,UAAaF,GACzBG,EAAoB,OAAUD,EAAW,sBAElCE,EAAM,IAEbC,EAAQ,EAAM,CAClBC,gBAAiB,OACjBC,oBAAqB,gBAGjBC,GAAW,IAAAC,YAAW,CAC1BxB,OAAQ,mBAAsB,CAC5ByB,OAAO,EACPC,WAAW,EACXC,sBAAuB,EACvBC,QACE,0FAEJC,SAAU,oCACVC,OAAQ,sCACRC,WAAY,CAAC,WAgBXjB,IACF1F,QAAQ0C,IAAI,cACZqD,EAAIa,IAAI,MAQVb,EAAIa,IAAI,KACRb,EAAIa,IAAI,EAAO,QAEfb,EAAIa,IAAI,aAAsB,CAAEC,UAAU,KAC1Cd,EAAIa,IAAI,UAERb,EAAIe,OAAO,OAAQ,cACnBf,EAAIgB,IAAI,cAAe,QACvBhB,EAAIgB,IAAI,QAASjB,GACjBC,EAAIgB,IAAI,cAAe,GAEvB,IACEhB,EAAIa,IAAI,UAAW,KAEnBb,EAAIa,IACF,aACAT,EACAH,EAAMgB,MAAM,CAAC,WACb,IACA,KAEFjB,EAAIa,IACF,QAAQ,OACRT,EACAH,EAAMgB,MAAM,CAAC,CAAC,cAAe,CAAC,aAC9B,IACA,IACA,IACA,IACA,IACA,IAEJ,CAAE,MAAOxH,GACPQ,QAAQ0C,IAAI,+BAAgClD,EAC9C,CAEAuG,EAAIa,IAAI,SAAed,IACvBC,EAAI9F,IAAI,KAAK,CAACC,EAAKC,KACjBA,EAAI8G,SAAS,OAAUnB,EAAmB,cAAc,IAG1D,MAAMoB,EAAaxB,EAAe,GAAK,YACjCyB,EAAOzB,EAAe0B,QAAQC,IAAIC,YAAc,GACtDtH,QAAQ0C,IAAI,iCAAkCwE,EAAYC,EAAMzB,GAChE,MAAM6B,EAASxB,EAAIyB,OAAOL,GAAQ,KAAMD,GAAY,KAClD,MAAMO,EAAOF,EAAOG,UAAUA,QACxBP,EAAOI,EAAOG,UAAUP,KAE9BnH,QAAQ0C,IACN,0DACA+E,EACAN,EACD,I,qFCzHH,MAsBA,OACK,OAAc,MACjBQ,gBAxBsB,CAACC,EAAQC,KAC/B,QAAO,IAAG,QAAgBD,EAAQC,mBAAwB,MAwB1DlH,gBAtBsB,CAACxB,EAASuB,EAAWE,KAC3C,SACE,QAAgBzB,GACJmC,MAAZV,EACI,CAAC,YAAa,KAAMF,GACpB,CACE,CAAC,YAAa,KAAMA,GACpB,CAAC,SAAU,KAAME,KAgBzBN,qBAb2B,CAACnB,EAASuB,EAAWE,EAAUP,KAC1D,MAAMyH,EAAgBlH,EAClB,CAAC,CAAC,YAAa,KAAMF,GAAY,CAAC,SAAU,KAAME,GAAWP,GAC7DK,EACA,CAAC,CAAC,YAAa,KAAMA,GAAYL,GACjCA,EACJ,OAAO,SAAO,QAAgBlB,GAAU2I,EAAc,E,UCvBxD7F,EAAOC,QAAUC,QAAQ,c,8CCGzB,SAAe,E,OAAA,GAAc,K,UCH7BF,EAAOC,QAAUC,QAAQ,c,gECQzB,MAAM4F,EAAa,WACnB,IAgHA,SAAS3I,EAAIC,EAAUC,EAAIC,EAASC,EAAOC,GACzC,OAAOH,IACJI,MAAMC,GACLN,EACGO,OAAO,KACPC,KAAKJ,IAAcF,EAAUA,EAAQI,GAAUA,MAEnDG,OAAOC,IACNC,QAAQR,MAAMO,GACPV,EAASO,OAAO,KAAKC,KAAKL,EAAQA,EAAMO,GAAOA,KAE5D,CAzHAgI,EAAW9H,IAAI,QAAQ,kBAAyB,QAAa,CAACC,EAAKC,KACjEH,QAAQ0C,IAAI,YAAaxC,EAAIE,OACzBF,EAAIE,MAAMC,UACZjB,EAAIe,GAAK,IACP,IAAY6H,cACV9H,EAAIM,OAAOC,GACXP,EAAIM,OAAOI,SACXV,EAAIE,MAAMC,aAIdjB,EAAIe,GAAK,IAAM,IAAYI,QAAQL,EAAIM,OAAOC,GAAIP,EAAIM,OAAOI,WAC/D,IAGFmH,EAAW9H,IACT,QAAQ,kBAAyB,gBACjC,CAACC,EAAKC,KACJf,EAAIe,GAAK,IACP,IAAYI,QAAQL,EAAIM,OAAOC,GAAIP,EAAIM,OAAOI,SAAUV,EAAIM,OAAOyH,SACpE,IAILF,EAAWlH,KACT,QAAQ,kBAAyB,QACjCyB,MAAOpC,EAAKC,KACV,MAAMV,EAAO,IACRS,EAAIY,KACPL,IAAI,QAAWP,EAAIY,KAAKoH,UACxB1F,YAAa,IAAIxB,KACjBpB,OAAQ,OAGJuI,QAAa,IAAY5H,QAC7BL,EAAIM,OAAOC,GACXP,EAAIM,OAAOI,SACXnB,EAAKgB,IAEP,GAAI0H,EAAK5F,KAEP,OADAvC,QAAQ0C,IAAI,aAAcyF,GACnBhI,EAAIP,OAAO,KAAKC,KAAK,eAG9BT,EACEe,GACA,IACE,IAAYe,QAAQC,MAClB,IACA,CAAC1B,GAAM2B,OAAO,CAAClB,EAAIM,OAAOC,GAAIP,EAAIM,OAAOI,SAAUnB,EAAKgB,YAE5Da,OACAA,EACA7B,EACD,IAILsI,EAAWxG,IACT,QAAQ,kBAAyB,gBACjC,CAACrB,EAAKC,KACJ,MAAMV,EAAO,IAAKS,EAAIY,KAAMU,YAAa,IAAIR,MAC7C5B,EAAIe,GAAK,IACP,IAAYsB,WAAWN,MACrB,IACA,CAAC1B,GAAM2B,OAAO,CAAClB,EAAIM,OAAOC,GAAIP,EAAIM,OAAOI,SAAUV,EAAIM,OAAOyH,WAEjE,IAILF,EAAWxG,IAAI,QAAQ,kBAAyB,QAAa,CAACrB,EAAKC,KACjE,MACMiI,EADO,IAAIlI,EAAIY,MACGe,KAAKC,GACpB,IAAYL,WAAWN,MAC5B,IACA,CAAC,IAAKW,EAAMN,YAAa,IAAIR,OAAUI,OAAO,CAC5ClB,EAAIM,OAAOC,GACXP,EAAIM,OAAOI,SACXkB,EAAKrB,QAIXrB,EAAIe,GAAK,IAAM4B,QAAQC,IAAIoG,IAAY,IAGzCL,EAAWrG,OACT,QAAQ,kBAAyB,gBACjC,CAACxB,EAAKC,KACJf,EAAIe,GAAK,IACP,IAAYwB,WAAWR,MACrB,IACA,CAAC,CAAC,GAAGC,OAAO,CAAClB,EAAIM,OAAOC,GAAIP,EAAIM,OAAOI,SAAUV,EAAIM,OAAOyH,WAE/D,IAILF,EAAWrG,OAAO,QAAQ,kBAAyB,QAAa,CAACxB,EAAKC,KACpE,MACMyB,EADO,IAAI1B,EAAIY,MACGe,KAAKC,GACpB,IAAYH,WAAWR,MAC5B,IACA,CAAC,MAAMC,OAAO,CAAClB,EAAIM,OAAOC,GAAIP,EAAIM,OAAOI,SAAUkB,EAAKrB,QAG5DrB,EAAIe,GAAK,IAAM4B,QAAQC,IAAIJ,IAAY,G,yEClHzC,SAASyG,EAAiBC,GACxB,MAAO,IAAI,IAAIC,WAAWD,IACvBzG,KAAK2G,GAASA,EAAK9D,SAAS,IAAI+D,SAAS,EAAG,OAC5CC,KAAK,GACV,CAuEOpG,eAAeqG,EAAcC,EAASpI,GAC3C,MAAMqI,QAlCDvG,eAA2BwG,EAAMC,GACtC,MAAMC,EAAU,IAAIC,YACdC,EAAOC,OAAOC,gBAAgB,IAAIb,WAAW,KAC7Cc,EAAKF,OAAOC,gBAAgB,IAAIb,WAAW,KAC3CpE,QApBR7B,eAAyByG,EAAUG,GACjC,MAAMI,QAbRhH,eAA4ByG,GAC1B,MACMO,GADU,IAAIL,aACQM,OAAOR,GACnC,OAAOI,OAAOK,OAAOC,UACnB,MACAH,EACA,CAAE/G,KAAM,WACR,EACA,CAAC,aAEL,CAG4BmH,CAAaX,GACvC,OAAOI,OAAOK,OAAOG,UACnB,CACEpH,KAAM,SACN2G,KAAMA,EACNU,WAAY,IACZ7F,KAAM,WAERuF,EACA,CAAE/G,KAAM,UAAWsH,OAAQ,MAC3B,EACA,CAAC,UAAW,WAEhB,CAMoBF,CAAUZ,EAAUG,GAQtC,MAAO,CACLY,WAAYzB,QAPUc,OAAOK,OAAOO,QACpC,CAAExH,KAAM,UAAW8G,GAAIA,GACvBlF,EACA6E,EAAQO,OAAOT,KAKfO,GAAIhB,EAAiBgB,GACrBH,KAAMb,EAAiBa,GAE3B,CAiB+Bc,CAC3BtG,KAAKC,UAAUnD,GACf4G,QAAQC,IAAI4C,qBAGd,MAAO,GAAGrB,OAAaC,EAAeiB,gBAAgBjB,EAAeQ,QAAQR,EAAeK,MAC9F,C,OApFA,SCuFA,QAnFA5G,eAAyBpC,EAAKC,EAAK+J,GACjC,IAAIC,EAAS,KACb,GAAI,WAAW,SAAUjK,EAAIE,MAAMgK,MAAMzF,MAAM,MAAO,CACpD,IAAKzE,EAAIE,MAAMiK,QAAUnK,EAAIE,MAAM2I,SAAU,CAE3C,MAAMvI,EAAS,CACba,UAAWnB,EAAIE,MAAMiB,UACrBiJ,aAAcpK,EAAIE,MAAMkK,aACxBF,MAAOlK,EAAIE,MAAMgK,MACjBG,MAAOrK,EAAIE,MAAMmK,OAEbC,QAAoB7B,EAAc,WAAYnI,GAGpD,YAFAL,EAAIsK,SAASD,EAGf,CAUE,GATAL,QAAe,QAAUjK,EAAIE,MAAMiB,kBAEV,QACvB8I,EAAOzJ,UACPyJ,EAAOO,OACPxK,EAAIE,MAAMiK,MACVnK,EAAIE,MAAM2I,UAGK,CACf,MAAMvI,EAAS,CACba,UAAWnB,EAAIE,MAAMiB,UACrBiJ,aAAcpK,EAAIE,MAAMkK,aACxBF,MAAOlK,EAAIE,MAAMgK,MACjBG,MAAOrK,EAAIE,MAAMmK,OAEbC,QAAoB7B,EAAc,WAAYnI,GAGpD,YAFAL,EAAIsK,SAASD,EAGf,CAEJ,MACEL,QAAe,QAAUjK,EAAIE,MAAMiB,WAGrC,GAAK8I,EAIE,IAAK,WAAWjK,EAAIE,MAAMkK,aAAcH,EAAOQ,eAQ/C,CACL,MAAMC,EAAS1K,EAAIE,MAAMgK,MAAQlK,EAAIE,MAAMgK,MAAMzF,MAAM,UAAOrD,EAE9D,GAAI,aAAasJ,EAAQT,EAAOC,OAAOP,OAAS,EAAG,CACjD,MAAMgB,GAAY,QAAS3K,EAAIE,MAAMkK,aAAc,CACjD9K,MAAO,kBAGT,YADAW,EAAIsK,SAASI,EAEf,CAEA,MAAMC,EAAQ,WAAsB,GAGpCZ,EAAWa,OAAOC,SAASF,GAAS5K,EAAIE,MAExC,MAAMI,EAAS,CACb2J,OAAQA,EACRW,MAAOA,EACPV,MAAOQ,EACPP,MAAOnK,EAAIE,MAAMiK,OAEbG,QAAoB7B,EAAc,aAAcnI,GAGtD,YAFAL,EAAIsK,SAASD,EAGf,CA3BE,OANAxK,QAAQ0C,IACN,8CACAyH,EAAOQ,cACPzK,EAAIE,MAAMkK,mBAEZnK,EAAI8K,OAAO,QAAS,CAAEzL,MAAO,wBA4B/B,CAnCE,OAFAQ,QAAQ0C,IAAI,oBAAqBxC,EAAIE,MAAMiB,gBAC3ClB,EAAI8K,OAAO,QAAS,CAAEzL,MAAO,kBAqCjC,C,UCtFAyC,EAAOC,QAAUC,QAAQ,Q,gECIzB,MAwBA,OACK,OAAc,MACjB+I,QAvBc,CAACC,EAAgBzK,EAAWE,KAC1C,SACE,QAAQuK,GACI7J,MAAZV,EACI,CAAC,YAAa,KAAMF,GACpB,CACE,CAAC,YAAa,KAAMA,GACpB,CAAC,SAAU,KAAME,KAiBzBwK,aAdmB,CAACD,EAAgBzK,EAAWE,EAAUP,KACzD,MAAMyH,EAAgBlH,EAClB,CAAC,CAAC,YAAa,KAAMF,GAAY,CAAC,SAAU,KAAME,GAAWP,GAC7DK,EACA,CAAC,CAAC,YAAa,KAAMA,GAAYL,GACjCA,EACJ,OAAO,QAAO8K,EAAeA,GAAiBrD,EAAc,EAS5DuD,uBAP6B,CAACF,EAAgBG,KAC9C,SAAO,QAAQH,EAAgBG,EAAO,oBAAqB,MAO3DC,mBA7ByB,CAAC3D,EAAQ4D,KAClC,QAAO,IAAG,QAAQ5D,EAAQ,MAAO,CAAC,aAAc,KAAM4D,I,wMCLxD,MAAM,EAA+BrJ,QAAQ,UCShCsJ,EAAe,WACfC,EAAc,cACdC,EAAa,SACbC,EAAY,QACZC,EAAoB,gBAIpBC,EAAkB,cAIzB1K,EAAS,IAAI2K,IACjBA,EAAMC,QAAO,CAACC,EAAKC,IAAQ,SAASD,EAAKC,EAAM,IAAIA,IAAQ,MAEhDC,EAAezL,GAAcU,EAAOqK,EAAc/K,GAClD0L,EAAa,CAAC1L,EAAWE,IACpCQ,EAAO+K,EAAYzL,GAAYgL,EAAa9K,GACjCyL,EAAY,CAAC3L,EAAWE,EAAU0L,EAASC,EAAYC,IAClEpL,EACEgL,EAAW1L,EAAWE,GACtB+K,EACAW,EACAC,EACAC,GAESC,EAAW,CAAC/L,EAAWE,EAAUqH,IAC5C7G,EAAOgL,EAAW1L,EAAWE,GAAWgL,EAAW3D,GACxCyE,EAAmB,CAAChM,EAAW2B,IAC1CjB,EAAO+K,EAAYzL,GAAYmL,EAAmBxJ,GAIvCsK,EAAiB,CAACjM,EAAW2B,EAAgBuK,IACxDxL,EACEsL,EAAiBhM,EAAW2B,GAC5ByJ,EACAc,GAQSC,EAAYjF,GAAWxG,EAnDX,QAmD6BwG,GACzCkF,EAAU,CAAClF,EAAQ0D,EAAOyB,EAAWC,IAChD5L,EAAOyL,EAASjF,GApDM,YAoDa0D,EAAOyB,EAAWC,GAC1CC,EAAkB,CAACrF,EAAQsF,IACtC9L,EAAOyL,EAASjF,GArDc,YAqDasF,GAChCC,EAAe,CAACvF,EAAQwF,IACnChM,EAAOyL,EAASjF,GAtDO,QAsDawF,GACzBC,EAAY,CAACzF,EAAQ0F,IAChClM,EAAOyL,EAASjF,GAvDQ,SAuDa0F,GAE1BC,EAAc9M,IACzB,MAAM+M,EAAM,IAAIC,OAAO,OAAOhN,EAAGoJ,WAEjC,OADW6D,IAAIC,gBAAgB,IAAI,EAAAC,KAAK,KAAKnJ,OAAO,IACxCoJ,QAAQL,EAAK/M,EAAG,C,4FChE9B,SAAe,E,OAAA,GAAc,MCIhBqN,EAAWxL,eACT,EAAY/B,QAJZ,iBAOFwN,EAAUzL,MAAO5B,EAAWsN,EAAY3D,KACnD,MAAM4D,QAAc,IAAYC,eAAexN,EAAWsN,EAAY3D,GACtE,IAAIlC,EAAO,KAKX,OAJoB,GAAhB8F,EAAMpE,SACR1B,EAAO8F,EAAM,IAGR9F,CAAI,EAGAgG,EAAa7L,MAAO5B,EAAWsN,EAAY3D,EAAOtB,UACpC,IAAYqF,iBACnC1N,EACAsN,EACA3D,EACAtB,GAMSsF,EAAY/L,MAAOgM,IAC9B,IAAIC,QAAgB,IAAmBhO,QA5B3B,cA4B0C+N,GAEtD,OAAyBhN,MAArBiN,EAAQlN,UAA+B,KAEpCkN,CAAO,C,UCrChBtM,EAAOC,QAAUC,QAAQ,O,gECIzB,MAOA,OACK,OAAc,MACjBiM,iBATuB,CAAC1N,EAAWE,EAAUyJ,EAAOtB,KACpD,SAAW,QAASrI,EAAWE,GAAWmI,EAAU,CAAC,QAAS,KAAMsB,IASpE6D,eARqB,CAACxN,EAAWE,EAAUyJ,KAC3C,SAAO,QAAS3J,EAAWE,GAAW,CAAC,QAAS,KAAMyJ,IAQtDrC,cAPoB,CAACtH,EAAWE,EAAUP,KAC1C,SAAO,QAASK,EAAWE,GAAWP,G,uDCNxC,SAAe,E,OAAA,GAAc,MCKvBmO,EAAmB,WACzB,IAmGA,SAASpP,EAAIC,EAAUC,EAAIC,EAASC,EAAOC,GACzC,OAAOH,IACJI,MAAMC,GACLN,EACGO,OAAO,KACPC,KAAKJ,IAAcF,EAAUA,EAAQI,GAAUA,MAEnDG,OAAOC,IACNC,QAAQR,MAAMO,GACPV,EAASO,OAAO,KAAKC,KAAKL,EAAQA,EAAMO,GAAOA,KAE5D,CA5GAyO,EAAiBvO,IACf,QAAQ,wBAAqC,sBAC7C,CAACC,EAAKC,KACJf,EAAIe,GAAK,IACP,EAAkBI,QAChBL,EAAIM,OAAOC,GACXP,EAAIM,OAAO6B,eACXnC,EAAIM,OAAOoM,eAEd,IAIL4B,EAAiBvO,IACf,QAAQ,wBAAqC,QAC7C,CAACC,EAAKC,KACJf,EAAIe,GAAK,IACP,EAAkBI,QAAQL,EAAIM,OAAOC,GAAIP,EAAIM,OAAO6B,iBACrD,IAILmM,EAAiB3N,KACf,QAAQ,wBAAqC,QAC7CyB,MAAOpC,EAAKC,KACV,MAAMV,EAAO,IACRS,EAAIY,KACPL,IAAI,QAAWP,EAAIY,KAAKyB,MACxBC,YAAa,IAAIxB,KACjByN,SAAS,EACT7O,OAAQ,OAGJ8O,QAAmB,EAAkBnO,QACzCL,EAAIM,OAAOC,GACXP,EAAIM,OAAO6B,eACX5C,EAAKgB,IAEP,GAAIiO,EAAWnM,KAEb,OADAvC,QAAQ0C,IAAI,mBAAoBgM,GACzBvO,EAAIP,OAAO,KAAKC,KAAK,eAG9BT,EACEe,GACA,IACE,EAAkBe,QAAQC,MACxB,EACA,CAAC1B,GAAM2B,OAAO,CAAClB,EAAIM,OAAOC,GAAIP,EAAIM,OAAO6B,eAAgB5C,EAAKgB,YAElEa,OACAA,EACA7B,EACD,IAIL+O,EAAiBjN,IACf,QAAQ,wBAAqC,sBAC7C,CAACrB,EAAKC,KACJ,MAAMV,EAAO,IACRS,EAAIY,KACPU,YAAa,IAAIR,KACjByN,SAAS,EACT7O,OAAQ,WAEVR,EAAIe,GAAK,IACP,EAAkBsB,WAAWN,MAC3B,EACA,CAAC1B,GAAM2B,OAAO,CACZlB,EAAIM,OAAOC,GACXP,EAAIM,OAAO6B,eACXnC,EAAIM,OAAOoM,iBAGhB,IAIL4B,EAAiB9M,OACf,QAAQ,wBAAqC,sBAC7C,CAACxB,EAAKC,KACJ,MAAMV,EAAO,CAAC,EACdL,EAAIe,GAAK,IACP,EAAkBwB,WAAWR,MAC3B,EACA,CAAC1B,GAAM2B,OAAO,CACZlB,EAAIM,OAAOC,GACXP,EAAIM,OAAO6B,eACXnC,EAAIM,OAAOoM,iBAGhB,G,uDCpGL,MAAM+B,EAAY,WAClB,IAEM7B,EAAU,MA+IhB,SAAS1N,EAAIC,EAAUC,EAAIC,EAASC,EAAOC,GACzC,OAAOH,IACJI,MAAMC,GACLN,EACGO,OAAO,KACPC,KAAKJ,IAAcF,EAAUA,EAAQI,GAAUA,MAEnDG,OAAOC,IACNC,QAAQR,MAAMO,GACPV,EAASO,OAAO,KAAKC,KAAKL,EAAQA,EAAMO,GAAOA,KAE5D,CAxJA4O,EAAU1O,IAAI,IAAI6M,MAAY,CAAC5M,EAAKC,KAC9BD,EAAIE,MAAMC,UACZjB,EAAIe,GAAK,IACP,IAAWiL,aAAa0B,EAAS,KAAM,KAAM5M,EAAIE,MAAMC,aAGzDjB,EAAIe,GAAK,IAAM,IAAWI,QAAQuM,IACpC,IAGF6B,EAAU1O,IAAI,IAAI6M,SAAe,CAAC5M,EAAKC,KACrCf,EAAIe,GAAK,IAAM,IAAWI,QAAQuM,EAAS5M,EAAIM,OAAOC,KAAI,IAG5DkO,EAAU1O,IAAI,IAAI6M,0BAAgC,CAAC5M,EAAKC,KACtDf,EAAIe,GAAK,IAAM,IAAWkL,uBAAuByB,EAAS5M,EAAIM,OAAOC,KAAI,IAG3EkO,EAAU1O,IAAI,mBAAmB,CAACC,EAAKC,KACrCf,EAAIe,GAAK,IAAM,IAAW+K,QAAQ4B,EAAS5M,EAAIM,OAAOE,aAClDR,EAAIE,MAAMC,UACZjB,EAAIe,GAAK,IACP,IAAWiL,aACT0B,EACA5M,EAAIM,OAAOE,UACX,KACAR,EAAIE,MAAMC,aAIdjB,EAAIe,GAAK,IAAM,IAAW+K,QAAQ4B,EAAS5M,EAAIM,OAAOE,YACxD,IAGFiO,EAAU1O,IAAI,6BAA6B,CAACC,EAAKC,KAC3CD,EAAIE,MAAMC,UACZjB,EAAIe,GAAK,IACP,IAAWiL,aACT0B,EACA5M,EAAIM,OAAOE,UACXR,EAAIM,OAAOI,SACXV,EAAIE,MAAMC,aAIdjB,EAAIe,GAAK,IACP,IAAW+K,QAAQ4B,EAAS5M,EAAIM,OAAOE,UAAWR,EAAIM,OAAOI,WAEjE,IAGF+N,EAAU9N,KAAK,IAAIiM,MAAY,CAAC5M,EAAKC,KACnC,MAAMV,EAAO,IAAKS,EAAIY,KAAM0B,YAAa,IAAIxB,KAAQpB,OAAQ,OAC7DR,EACEe,GACA,IACE,IAAWe,QAAQC,MAAM,IAAY,CAAC1B,GAAM2B,OAAO,CAAC0L,EAASrN,EAAKgB,YACpEa,OACAA,EACA7B,EACD,IAGHkP,EAAU9N,KAAK,IAAIiM,0BAAgC,CAAC5M,EAAKC,KACvD,MAAMV,EAAO,IAAKS,EAAIY,KAAM0B,YAAa,IAAIxB,KAAQpB,OAAQ,OAC7DR,EACEe,GACA,IACE,IAAWe,QAAQC,MACjB,IACA,CAAC1B,GAAM2B,OAAO,CAAC0L,EAAS5M,EAAIM,OAAOC,GAAI,mBAAoBhB,EAAKgB,YAEpEa,OACAA,EACA7B,EACD,IAGHkP,EAAUpN,IAAI,IAAIuL,KAAW,CAAC5M,EAAKC,KACjC,MAAMV,EAAO,IAAKS,EAAIY,KAAMU,YAAa,IAAIR,KAAQpB,OAAQ,WAC7DR,EAAIe,GAAK,IACP,IAAWsB,WAAWN,MAAM,IAAY,CAAC1B,GAAM2B,OAAO,CAAC0L,EAASrN,EAAKgB,OACtE,IAGHkO,EAAUpN,IAAI,IAAIuL,SAAe,CAAC5M,EAAKC,KACrC,MAAMV,EAAO,IAAKS,EAAIY,KAAMU,YAAa,IAAIR,KAAQpB,OAAQ,WAC7DR,EAAIe,GAAK,IACP,IAAWsB,WAAWN,MACpB,IACA,CAAC1B,GAAM2B,OAAO,CAAC0L,EAAS5M,EAAIM,OAAOC,OAEtC,IAGHkO,EAAUpN,IAAI,IAAIuL,mCAAyC,CAAC5M,EAAKC,KAC/D,MAAMV,EAAO,IAAKS,EAAIY,KAAMU,YAAa,IAAIR,KAAQpB,OAAQ,WAC7DR,EAAIe,GAAK,IACP,IAAWsB,WAAWN,MACpB,IACA,CAAC1B,GAAM2B,OAAO,CAAC0L,EAAS5M,EAAIM,OAAOC,GAAIP,EAAIM,OAAOwM,YAErD,IAGH2B,EAAUjN,OAAO,IAAIoL,SAAe,CAAC5M,EAAKC,KACxC,MAAMV,EAAO,CAAC,EACdL,EAAIe,GAAK,IACP,IAAWwB,WAAWR,MACpB,IACA,CAAC1B,GAAM2B,OAAO,CAAC0L,EAAS5M,EAAIM,OAAOC,OAEtC,IAGHkO,EAAUjN,OAAO,IAAIoL,mCAAyC,CAAC5M,EAAKC,KAClEf,EAAIe,GAAK,IACP,IAAWwB,WAAWR,MACpB,IACA,CAAC,MAAMC,OAAO,CACZ0L,EACA5M,EAAIM,OAAOC,GACX,mBACAP,EAAIM,OAAOwM,YAGhB,IAGH2B,EAAUjN,OAAO,IAAIoL,KAAW,CAAC5M,EAAKC,KACpC,MACMyB,EADO,IAAI1B,EAAIY,MACGe,KAAKC,GACpB,IAAWH,WAAWR,MAC3B,IACA,CAAC,MAAMC,OAAO,CAAC0L,EAAShL,EAAKrB,QAGjCrB,EAAIe,GAAK,IAAM4B,QAAQC,IAAIJ,IAAY,G,UCjJzCK,EAAOC,QAAUC,QAAQ,W,yECIzB,MAEA,OAAoB,OAAc,MAAcyM,iBAFtBnO,IAAO,SAAO,UAAe,CAAC,SAAU,KAAMA,KCAlEoO,EAAgB,WACtB,IAoEA,SAASzP,EAAIC,EAAUC,EAAIC,EAASC,EAAOC,GACzC,OAAOH,IACJI,MAAMC,GACLN,EACGO,OAAO,KACPC,KAAKJ,IAAcF,EAAUA,EAAQI,GAAUA,MAEnDG,OAAOC,IACNC,QAAQR,MAAMO,GACPV,EAASO,OAAO,KAAKC,KAAKL,EAAQA,EAAMO,GAAOA,KAE5D,CA7EA8O,EAAc5O,IAAI,KAAK,CAACC,EAAKC,KAC3Bf,EAAIe,GAAK,IAAM,EAAeI,QAAQL,EAAIM,OAAOC,KAAI,IAGvDoO,EAAc5O,IAAI,QAAQ,CAACC,EAAKC,KAC9Bf,EAAIe,GAAK,IAAM,EAAeI,QAAQL,EAAIM,OAAOC,KAAI,IAGvDoO,EAAc5O,IAAI,sBAAsB,CAACC,EAAKC,KAC5Cf,EAAIe,GAAK,IAAM,EAAeyO,iBAAiB1O,EAAIM,OAAOC,KAAI,IAGhEoO,EAAchO,KAAK,KAAKyB,MAAOpC,EAAKC,KAClC,MAAMV,EAAO,IACRS,EAAIY,KACPL,IAAI,QAAWP,EAAIY,KAAKyB,MACxBC,YAAa,IAAIxB,KACjBpB,OAAQ,OAGJkP,QAAgB,EAAevO,QAAQd,EAAKgB,IAClD,GAAIqO,EAAQvM,KAEV,OADAvC,QAAQ0C,IAAI,gBAAiBoM,GACtB3O,EAAIP,OAAO,KAAKC,KAAK,eAG9BT,EACEe,GACA,IACE,EAAee,QAAQC,MAAM,EAAgB,CAAC1B,GAAM2B,OAAO,CAAC3B,EAAKgB,YACnEa,OACAA,EACA7B,EACD,IAGHoP,EAActN,IAAI,QAAQ,CAACrB,EAAKC,KAC9B,MAAMV,EAAO,IAAKS,EAAIY,KAAMU,YAAa,IAAIR,KAAQpB,OAAQ,WAC7DR,EAAIe,GAAK,IACP,EAAesB,WAAWN,MACxB,EACA,CAAC1B,GAAM2B,OAAO,CAAClB,EAAIM,OAAOC,OAE7B,IAGHoO,EAAcnN,OAAO,QAAQ,CAACxB,EAAKC,KACjC,MAAMV,EAAO,CAAC,EAEdL,EAAIe,GAAK,IACP,EAAewB,WAAWR,MACxB,EACA,CAAC1B,GAAM2B,OAAO,CAAClB,EAAIM,OAAOC,OAE7B,IAGHoO,EAAcnN,OAAO,KAAK,CAACxB,EAAKC,KAC9B,MACMyB,EADO,IAAI1B,EAAIY,MACGe,KAAKC,GACpB,EAAeH,WAAWR,MAAM,EAAgB,CAACW,MAE1D1C,EAAIe,GAAK,IAAM4B,QAAQC,IAAIJ,IAAY,G,uHCrEzC,MAAM,EAA+BO,QAAQ,uBCAvC,GCA+BA,QAAQ,6BDARA,QAAQ,mBEARA,QAAQ,sB,OCC7C,SAEA,MAcA,EAduB,CACrB4M,KAAM3H,QAAQC,IAAI2H,cAClBC,WAAY7H,QAAQC,IAAI6H,oBACxBC,eAAgB/H,QAAQC,IAAI+H,wBAC5BC,YAAajI,QAAQC,IAAIiI,qBACzBC,aAAcnI,QAAQC,IAAImI,sBAC1BnO,UAAW+F,QAAQC,IAAIoI,mBACvBC,SAAUtI,QAAQC,IAAIsI,kBACtBC,UAAWxI,QAAQC,IAAIwI,mBACvBC,4BAA6B1I,QAAQC,IAAI0I,qCACzCC,qBAAsB5I,QAAQC,IAAI4I,8BAClCC,gBAAiB9I,QAAQC,IAAI8I,0BCdzB,EAA+BhO,QAAQ,eCQtC,SAASiO,IACd,gBAAuB,CACrBC,WAAY,aAAiBC,KAAK,GAClCC,UAAW,EAAetB,YAE9B,CAsCO3M,eAAekO,EAAOC,EAAMC,GACjC,MAAOC,EAAgBC,GAgHzB,SAAmCH,GACjC,MAAMI,EAAMJ,EAAK9L,MAAM,KAEvB,OAAImM,EAAOD,EAAIhH,QACN,CAAC,OAAOgH,GAAKnI,KAAK,KAAM,OAAOmI,IAGjC,CAACJ,EACV,CAxHoCM,CAA0BN,GAC5D,IAAIO,EAAMC,IAAKC,WAAWP,GAE1B,OAAIC,EACKI,EAAIG,IAAIP,GAAS3Q,MAAMP,KAAK0R,IAWnCV,GAAaA,EAAU7G,OAAS,EAC5BwH,MAAMC,QAAQZ,EAAU,UARrBA,EAAU1E,QAAO,CAACC,EAAKC,IACtBD,EAAIsF,MAAMpQ,MAAM8K,EAAKC,IAE1B8E,GAM6B/Q,YACpB+Q,EAAIO,MAAMpQ,MAAM6P,EAAKN,GAAWzQ,YAClC+Q,EAAI/Q,OACLuR,KAAK3P,IAAIuP,EACtB,CAMO9O,eAAemP,EAAYhB,GAChC,aAAaD,EAAOC,EAAM,KAC5B,CAEO,SAASiB,EAAmBjB,GACjC,OAAOQ,IACJC,WAAWT,GACXxQ,MACAP,MAAMS,GAAQA,EAAIwR,MACvB,CAsBO,SAASC,EAAOnB,EAAMhR,GAC3B,OAAOwR,IAAKE,IAAIV,GAAM1J,IAAItH,EAC5B,CAEO,SAASoS,EAAOpB,EAAMhR,GAC3B,OAAOwR,IAAKC,WAAWT,GAAMqB,IAAIrS,EACnC,CAEO,SAASsS,EAAUtB,EAAMhR,GAC9B,OAAOwR,IAAKE,IAAIV,GAAMuB,OAAOvS,EAC/B,CAOO,SAASwS,EAAUxB,EAAMhQ,GAC9B,MAAMoQ,EAAMJ,EAAK9L,MAAM,KAMvB,OAJMlE,IAAM,UAAUA,KAAQqQ,EAAOD,EAAIhH,UACvC4G,EAAO,OAAOI,GAAKnI,KAAK,KACxBjI,EAAK,OAAOoQ,IAEPI,IAAKC,WAAWT,GAAMU,IAAI1Q,GAAIiB,QACvC,CAEOY,eAAe6L,EAAWsC,EAAM1H,EAAU2H,GAC/C,MAAMzC,QAAcuC,EAAOC,EAAMC,GAEjC,OAAoB,GAAhBzC,EAAMpE,QACKoE,EAAM,GAEViE,kBAAoB,EAAInJ,EAGrC,CAEA,SAASkI,IACP,OAAO,aACT,CAMA,SAASH,EAAOqB,GACd,OAAOA,EAAM,GAAM,CACrB,CAEA,SAASf,EAASgB,GAChB,MAAO,CAAE3R,GAAI2R,EAAS3R,MAAO2R,EAAS3S,OACxC,C,UClKAwC,EAAOC,QAAUC,QAAQ,c,kFC+EzB,QAxEAG,eAAuBpC,EAAKC,EAAK+J,GAC/B,MACMY,EAAQ5K,EAAIY,KAAKgK,MACjB1K,EAAQ8J,EAAWa,OAAOC,SAASF,GAGzC,UAFOZ,EAAWa,OAAOC,SAASF,GAE7B1K,EAAL,CAMA,GAAIF,EAAIY,KAAKuR,QAAS,CACpB,GAA2B,QAAvBjS,EAAMkS,cAAyB,CAGjC,MAAM1H,GAAS,QAAkB1K,EAAIY,MAC/BqJ,QAAe,QAAU/J,EAAMiB,WAC/B8G,QAAa,QACjBgC,EAAOzJ,UACPyJ,EAAOO,OACPxK,EAAIY,KAAKuJ,OAGX,GAAI,aAAaO,EAAQT,EAAOC,OAAOP,OAAS,EAAG,CACjD,MAAMgB,GAAY,QAASzK,EAAMkK,aAAc,CAC7C9K,MAAO,kBAGT,YADAW,EAAIsK,SAASI,EAEf,CAEA,MAAM0H,EAAO,WAAsB,GAE7B9S,EAAO,CACX+S,QAASpS,EACT+H,KAAMA,EACNiC,MAAOQ,EACPpI,YAAa,IAAIxB,KACjBpB,OAAQ,gBAGJ,IAAYsB,QAAQC,MACxB,IACA,CAAC1B,GAAM2B,OAAO,CA3CL,gBA2CcmR,KAGzB,MAAM1H,GAAY,QAASzK,EAAMkK,aAAc,CAC7CiI,KAAMA,EACNhI,MAAOnK,EAAMmK,QAIf,YADApK,EAAIsK,SAASI,EAEf,CAAO,CAEL,MAAMA,GAAY,QAASzK,EAAMkK,aAAc,CAC7C9K,MAAO,8BAGT,YADAW,EAAIsK,SAASI,EAEf,CACF,CAAO,CAEL,MAAMA,GAAY,QAASzK,EAAMkK,aAAc,CAC7C9K,MAAO,kBAGT,YADAW,EAAIsK,SAASI,EAEf,CA3DA,CAFE1K,EAAI8K,OAAO,QAAS,CAAEzL,MAAO,qCA8DjC,C,UC7EAyC,EAAOC,QAAUC,QAAQ,S,yECIzB,MAIA,OAAoB,OAAc,MAAYsQ,eAJvB,CAAC/R,EAAWE,EAAUP,KAC3C,SAAO,QAAUK,EAAWE,GAAWP,GAGqBqS,gBAFtC,CAAChS,EAAWE,EAAU0L,KAC5C,SAAO,QAAU5L,EAAWE,EAAU0L,EAAS,WAAY,OCCvDqG,EAAc,WACdpG,EAAa,UAEnB,IA4NA,SAASnN,EAAIC,EAAUC,EAAIC,EAASC,EAAOC,GACzC,OAAOH,IACJI,MAAMC,GACLN,EACGO,OAAO,KACPC,KAAKJ,IAAcF,EAAUA,EAAQI,GAAUA,MAEnDG,OAAOC,IACNC,QAAQR,MAAMO,GACPV,EAASO,OAAO,KAAKC,KAAKL,EAAQA,EAAMO,GAAOA,KAE5D,CArOA4S,EAAY1S,IAAI,QAAQ,kBAAyB,QAAc,CAACC,EAAKC,KAC/DD,EAAIE,MAAMC,UACZjB,EAAIe,GAAK,IACP,EAAasS,eACXvS,EAAIM,OAAOC,GACXP,EAAIM,OAAOI,SACXV,EAAIE,MAAMC,aAIdjB,EAAIe,GAAK,IAAM,EAAaI,QAAQL,EAAIM,OAAOC,GAAIP,EAAIM,OAAOI,WAChE,IAGF+R,EAAY1S,IACV,QAAQ,kBAAyB,iBACjC,CAACC,EAAKC,KACJf,EAAIe,GAAK,IACP,EAAaI,QACXL,EAAIM,OAAOC,GACXP,EAAIM,OAAOI,SACXV,EAAIM,OAAO8L,UAEd,IAILqG,EAAY1S,IACV,QAAQ,kBAAyB,iBAAuBsM,KACxD,CAACrM,EAAKC,KACJf,EAAIe,GAAK,IACP,EAAauS,gBACXxS,EAAIM,OAAOC,GACXP,EAAIM,OAAOI,SACXV,EAAIM,OAAO8L,UAEd,IAILqG,EAAY9R,KACV,QAAQ,kBAAyB,QACjCyB,MAAOpC,EAAKC,KACV,MAAMV,EAAO,IACRS,EAAIY,KACPL,IAAI,QAAWP,EAAIY,KAAKyB,MACxBC,YAAa,IAAIxB,KACjBpB,OAAQ,OAGJgT,QAAc,EAAarS,QAC/BL,EAAIM,OAAOC,GACXP,EAAIM,OAAOI,SACXnB,EAAKgB,IAEP,GAAImS,EAAMrQ,KAER,OADAvC,QAAQ0C,IAAI,cAAekQ,GACpBzS,EAAIP,OAAO,KAAKC,KAAK,eAG9BT,EACEe,GACA,IACE,EAAae,QAAQC,MACnB,EACA,CAAC1B,GAAM2B,OAAO,CAAClB,EAAIM,OAAOC,GAAIP,EAAIM,OAAOI,SAAUnB,EAAKgB,YAE5Da,OACAA,EACA7B,EACD,IAILkT,EAAY9R,KACV,QAAQ,kBAAyB,iBAAuB0L,KACxDjK,MAAOpC,EAAKC,KACV,GAAIkR,MAAMC,QAAQpR,EAAIY,MAAO,CAC3B,MACM+R,EADO,IAAI3S,EAAIY,MACAe,KAAKiR,IACxB,MAAMhR,EAAO,IACRgR,EACHrS,IAAI,QAAWP,EAAIY,KAAKyB,MACxBC,YAAa,IAAIxB,MAEnB,OAAO,EAAaE,QAAQC,MAC1B,EACA,CAAC,IAAKW,EAAMU,YAAa,IAAIxB,OAAUI,OAAO,CAC5ClB,EAAIM,OAAOC,GACXP,EAAIM,OAAOI,SACXV,EAAIM,OAAO8L,QACXC,EACAzK,EAAKrB,KAER,IAEHrB,EAAIe,GAAK,IAAM4B,QAAQC,IAAI6Q,IAC7B,KAAO,CACL,MAAMpT,EAAO,IACRS,EAAIY,KACPL,IAAI,QAAWP,EAAIY,KAAKyB,MACxBC,YAAa,IAAIxB,MAEnB5B,EACEe,GACA,IACE,EAAae,QAAQC,MACnB,EACA,CAAC1B,GAAM2B,OAAO,CACZlB,EAAIM,OAAOC,GACXP,EAAIM,OAAOI,SACXV,EAAIM,OAAO8L,QACXC,EACA9M,EAAKgB,YAGXa,OACAA,EACA7B,EAEJ,KAIJkT,EAAYpR,IACV,QAAQ,kBAAyB,iBACjC,CAACrB,EAAKC,KACJ,MAAMV,EAAO,IAAKS,EAAIY,KAAMU,YAAa,IAAIR,MAC7C5B,EAAIe,GAAK,IACP,EAAasB,WAAWN,MACtB,EACA,CAAC1B,GAAM2B,OAAO,CAAClB,EAAIM,OAAOC,GAAIP,EAAIM,OAAOI,SAAUV,EAAIM,OAAO8L,YAEjE,IAILqG,EAAYpR,IAAI,QAAQ,kBAAyB,QAAc,CAACrB,EAAKC,KACnE,MACMiI,EADO,IAAIlI,EAAIY,MACGe,KAAKC,GACpB,EAAaL,WAAWN,MAC7B,EACA,CAAC,IAAKW,EAAMN,YAAa,IAAIR,OAAUI,OAAO,CAC5ClB,EAAIM,OAAOC,GACXP,EAAIM,OAAOI,SACXkB,EAAKrB,QAIXrB,EAAIe,GAAK,IAAM4B,QAAQC,IAAIoG,IAAY,IAGzCuK,EAAYjR,OACV,QAAQ,kBAAyB,iBAAuB6K,eACxD,CAACrM,EAAKC,KACJf,EAAIe,GAAK,IACP,EAAawB,WAAWR,MACtB,EACA,CAAC,MAAMC,OAAO,CACZlB,EAAIM,OAAOC,GACXP,EAAIM,OAAOI,SACXV,EAAIM,OAAO8L,QACXC,EACArM,EAAIM,OAAOgM,aAGhB,IAILmG,EAAYjR,OACV,QAAQ,kBAAyB,iBAAuB6K,KACxD,CAACrM,EAAKC,KACJ,MACMyB,EADO,IAAI1B,EAAIY,MACGe,KAAKC,GACpB,EAAaH,WAAWR,MAC7B,EACA,CAAC,MAAMC,OAAO,CACZlB,EAAIM,OAAOC,GACXP,EAAIM,OAAOI,SACXV,EAAIM,OAAO8L,QACXC,EACAzK,EAAKrB,QAIXrB,EAAIe,GAAK,IAAM4B,QAAQC,IAAIJ,IAAY,IAI3C+Q,EAAYjR,OACV,QAAQ,kBAAyB,iBACjC,CAACxB,EAAKC,KACJ,MAAMV,EAAO,IAAKS,EAAIY,MACtB1B,EAAIe,GAAK,IACP,EAAawB,WAAWR,MACtB,EACA,CAAC1B,GAAM2B,OAAO,CAAClB,EAAIM,OAAOC,GAAIP,EAAIM,OAAOI,SAAUV,EAAIM,OAAO8L,YAEjE,IAILqG,EAAYjR,OACV,QAAQ,kBAAyB,QACjC,CAACxB,EAAKC,KACJ,MACMyB,EADO,IAAI1B,EAAIY,MACGe,KAAKC,GACpB,EAAaH,WAAWR,MAC7B,EACA,CAAC,MAAMC,OAAO,CAAClB,EAAIM,OAAOC,GAAIP,EAAIM,OAAOI,SAAUkB,EAAKrB,QAG5DrB,EAAIe,GAAK,IAAM4B,QAAQC,IAAIJ,IAAY,G,8CClN3C,QAdAU,eAAqBpC,EAAKC,EAAK+J,GAC7B,IAAI6I,GAAe,QAAS7I,EAAWa,OAAOiI,sBAAuB,CACnEV,cAAe,OACfjI,MAAOnK,EAAIY,KAAKuJ,MAChBtB,SAAU7I,EAAIY,KAAKiI,SACnB1H,UAAWnB,EAAIY,KAAKO,UACpBiJ,aAAcpK,EAAIY,KAAKwJ,aACvBF,MAAOlK,EAAIY,KAAKsJ,MAChBG,MAAOrK,EAAIY,KAAKyJ,QAGlBpK,EAAIsK,SAASsI,EACf,C,UCdA9Q,EAAOC,QAAUC,QAAQ,M,4HCQzB,MAAM+H,EAAa,WACnB,KAEA,UAEA,MAAM+I,QAAsB,UACtBC,EAAa,CACjBF,sBAAuBC,EAAcD,sBACrCG,cAAeF,EAAcE,eAGzBnI,EAAW,CAAC,EAClBd,EAAWa,OAAS,IAAKmI,EAAYlI,YACrCd,EAAWjK,IACT,cACAqC,MAAOpC,EAAKC,UAAc,OAAUD,EAAKC,EAAK+J,KAGhDA,EAAWrJ,KACT,UACAyB,MAAOpC,EAAKC,UAAc,OAAMD,EAAKC,EAAK+J,KAG5CA,EAAWrJ,KACT,YACAyB,MAAOpC,EAAKC,UAAc,OAAQD,EAAKC,EAAK+J,KAG9CA,EAAWrJ,KACT,UACAyB,MAAOpC,EAAKC,UAAc,OAAMD,EAAKC,EAAK+J,K,yGCnC5C,SAAe,E,OAAA,GAAc,M,sBCkO7B,QA1NA5H,eAAqBpC,EAAKC,EAAK+J,GAC7B,MAAMtC,EAAS,gBAGTvD,EAAOnE,EAAIkT,QAAuB,cACxC,IAAI9E,EAAW,GACX+E,EAAe,GACnB,GAAIhP,EAAM,CAER,MAAMC,GAAoB,QAAwBD,GAElDiK,EAAWhK,EAAkB7D,GAC7B4S,EAAe/O,EAAkBM,MACnC,CAGA,GAAI1E,EAAIY,KAAKO,UAAW,CACtB,GAAIiN,EAOF,OALAtO,QAAQ0C,IACN,yDACAwH,QAEF/J,EAAIP,OAAO,KAAK0T,KAAK,CAAE9T,MAAO,mBAGhC8O,EAAWpO,EAAIY,KAAKO,UACpBgS,EAAenT,EAAIY,KAAKyS,aAE1B,CAEA,MAAMpJ,QAAe,QAAUmE,GAC/B,IAAKnE,EAGH,OAFAnK,QAAQ0C,IAAI,oBAAqB4L,QACjCnO,EAAIP,OAAO,KAAK0T,KAAK,CAAE9T,MAAO,mBAIhC,GAAI2K,EAAOoJ,eAAiBF,EAO1B,OANArT,QAAQ0C,IACN,+CACAyH,EAAOoJ,cACPF,QAEFlT,EAAIP,OAAO,KAAK0T,KAAK,CAAE9T,MAAO,mBAIhC,IAAK,WAAWU,EAAIY,KAAK0S,WAAYrJ,EAAOsJ,aAO1C,OANAzT,QAAQ0C,IACN,gDACAxC,EAAIY,KAAK0S,WACTrJ,EAAOsJ,YAAY/K,KAAK,WAE1BvI,EAAIP,OAAO,KAAK0T,KAAK,CAAE9T,MAAO,8BAIhC,GAA2B,sBAAvBU,EAAIY,KAAK0S,WAAb,CA+CO,GAA2B,sBAAvBtT,EAAIY,KAAK0S,WAAoC,CACtD,MAAMjB,QAAa,IAAYhS,QAAQqH,EAAQ1H,EAAIY,KAAKyR,MACxD,GAAIA,GAAQA,EAAKC,QAAS,OAClB,IAAY7Q,WAAWR,MAC3B,IACA,CAAC,CAAC,GAAGC,OAAO,CAACwG,EAAQ1H,EAAIY,KAAKyR,QAGhC,MAAMmB,QAAY,IAAWnI,mBA/GnB,MA+G6CpB,EAAO1D,UAC9D,GAAIiN,EAAI7J,OAAS,EAOf,OANA7J,QAAQ0C,IACN,kDACA4L,EACAnE,EAAO1D,eAETtG,EAAIP,OAAO,KAAK0T,KAAK,CAAE9T,MAAO,kBAGhC,GAAI+S,EAAKC,QAAQnR,WAAaiN,EAAU,CACtC,MAAMqF,EAAO,IAAI3S,KACX4S,EAAU5S,KAAK6S,IACnBF,EAAKG,iBACLH,EAAKI,cACLJ,EAAKK,aACLL,EAAKM,cACLN,EAAKO,gBACLP,EAAKQ,iBAEDC,EACJC,KAAKC,MAAMV,EAAU,KAAiC,GAAzBF,EAAI,GAAGa,gBACtCvU,QAAQ0C,IAAI,SAAUkR,EAASF,EAAKA,EAAI,GAAGa,iBAC3C,MAcMC,EAAiB,CACrBC,cAfmB,QACnB,sCACAtK,EAAOuK,YACPhB,EAAI,GAAGlI,WACP6I,KAAKC,MAAMV,EAAU,KACrBQ,EACAjK,EAAOC,OAUPgK,WAAYA,EACZjK,OARkB,CAClB9I,UAAWiN,EACX5N,UAAWyJ,EAAOzJ,UAClBgK,OAAQP,EAAOO,QAMfN,MAAOmI,EAAKnI,MACZjC,KAAMoK,EAAKpK,MAMb,YAHAhI,EAAIP,OAAO,KAAK0T,KAAKkB,EAIvB,CAOE,OANAxU,QAAQ0C,IACN,sCACA6P,EAAKC,QAAQnR,UACbiN,QAEFnO,EAAIP,OAAO,KAAK0T,KAAK,CAAE9T,MAAO,iBAGlC,CAGE,OAFAQ,QAAQ0C,IAAI,mBAAoBxC,EAAIY,KAAKyR,WACzCpS,EAAIP,OAAO,KAAK0T,KAAK,CAAE9T,MAAO,iBAGlC,CAAO,GAA2B,iBAAvBU,EAAIY,KAAK0S,WAA+B,CACjD,MAAMlG,QAAc,EAAa/M,QAAQL,EAAIY,KAAK6T,eAClD,GAAIrH,EAAO,CAKT,GAJAtN,QAAQ0C,IACN,wCACAxC,EAAIY,KAAK6T,eAEPrH,EAAMjM,WAAaiN,EAOrB,OANA,EAAa3M,WAAWR,MACtB,EACA,CAAC,CAAC,GAAGC,OAAO,CAACwG,EAAQ1H,EAAIY,KAAK6T,sBAGhCxU,EAAIP,OAAO,KAAK0T,KAAK,CAAE9T,MAAO,kBAGhC,MAQMgV,EAAiB,CACrBC,aATmB,aAUnBG,WAAY,SACZD,cAAerH,EAAMqH,eAGvB,YADAxU,EAAIP,OAAO,KAAK0T,KAAKkB,EAEvB,CAGE,OAFAxU,QAAQ0C,IAAI,qCACZvC,EAAIP,OAAO,KAAK0T,KAAK,CAAE9T,MAAO,iBAGlC,CACEQ,QAAQ0C,IAAI,wBAAyBxC,EAAIY,KAAK0S,YAC9CrT,EAAIP,OAAO,KAAK0T,KAAK,CAAE9T,MAAO,0BAChC,KA7JA,CACE,MAAMkU,QAAY,IAAWnI,mBAzDjB,MAyD2CpB,EAAO1D,UAC9D,GAAIiN,EAAI7J,OAAS,EAOf,OANA7J,QAAQ0C,IACN,kDACA4L,EACAnE,EAAO1D,eAETtG,EAAIP,OAAO,KAAK0T,KAAK,CAAE9T,MAAO,kBAGhC,MAAMmU,EAAO,IAAI3S,KACX4S,EAAU5S,KAAK6S,IACnBF,EAAKG,iBACLH,EAAKI,cACLJ,EAAKK,aACLL,EAAKM,cACLN,EAAKO,gBACLP,EAAKQ,iBAEDC,EAAaC,KAAKC,MAAMV,EAAU,KAAiC,GAAzBF,EAAI,GAAGa,gBACvDvU,QAAQ0C,IAAI,SAAUkR,EAASF,EAAKA,EAAI,GAAGa,iBAC3C,MAcMC,EAAiB,CACrBC,cAfmB,QACnB,sCACAtK,EAAOuK,YACPhB,EAAI,GAAGlI,WACP6I,KAAKC,MAAMV,EAAU,KACrBQ,EACAjK,EAAOC,OAUPgK,WAAYA,EACZjK,OARkB,CAClB9I,UAAWiN,EACX5N,UAAWyJ,EAAOzJ,UAClBgK,OAAQP,EAAOO,QAMfN,MAAOD,EAAOC,OAGhBjK,EAAIP,OAAO,KAAK0T,KAAKkB,EAkHvB,CACF,C,yEC/NA,MAKA,OACK,OAAc,MACjBK,cAPoB,CAACnU,EAAWE,KAChC,SAAO,QAAWF,EAAWE,GAAW,MAOxCkU,iBANwBpU,IACxB,SAAO,QAAWA,GAAY,CAAC,UAAW,MAAM,KCH5CqU,EAAe,WACrB,IAuFA,SAAS3V,EAAIC,EAAUC,EAAIC,EAASC,EAAOC,GACzC,OAAOH,IACJI,MAAMC,GACLN,EACGO,OAAO,KACPC,KAAKJ,IAAcF,EAAUA,EAAQI,GAAUA,MAEnDG,OAAOC,IACNC,QAAQR,MAAMO,GACPV,EAASO,OAAO,KAAKC,KAAKL,EAAQA,EAAMO,GAAOA,KAE5D,CAhGAgV,EAAa9U,IAAI,QAAQ,gBAAuB,CAACC,EAAKC,KACpDf,EAAIe,GAAK,IAAM,EAAc2U,iBAAiB5U,EAAIM,OAAOC,KAAI,IAG/DsU,EAAa9U,IAAI,QAAQ,kBAAyB,CAACC,EAAKC,KACtDf,EAAIe,GAAK,IACP,EAAc0U,cAAc3U,EAAIM,OAAOC,GAAIP,EAAIM,OAAOI,WACvD,IAGHmU,EAAa9U,IAAI,QAAQ,QAAe,CAACC,EAAKC,KAC5Cf,EAAIe,GAAK,IAAM,EAAcI,QAAQL,EAAIM,OAAOC,KAAI,IAGtDsU,EAAalU,KAAK,QAAQ,QAAeyB,MAAOpC,EAAKC,KACnD,MAAMV,EAAO,IACRS,EAAIY,KACPL,IAAI,QAAWP,EAAIY,KAAKyB,MACxBC,YAAa,IAAIxB,KACjBpB,OAAQ,OAGV,UADqB,EAAciV,cAAc3U,EAAIM,OAAOC,GAAIhB,EAAKgB,KAC1D8B,KACT,OAAOpC,EAAIP,OAAO,KAAKC,KAAK,eAE9BT,EACEe,GACA,IACE,EAAce,QAAQC,MACpB,EACA,CAAC1B,GAAM2B,OAAO,CAAClB,EAAIM,OAAOC,GAAIhB,EAAKgB,YAEvCa,OACAA,EACA7B,EACD,IAGHsV,EAAaxT,IAAI,QAAQ,kBAAyB,CAACrB,EAAKC,KACtD,MAAMV,EAAO,IAAKS,EAAIY,KAAMU,YAAa,IAAIR,KAAQpB,OAAQ,WAC7DR,EAAIe,GAAK,IACP,EAAcsB,WAAWN,MACvB,EACA,CAAC1B,GAAM2B,OAAO,CAAClB,EAAIM,OAAOC,GAAIP,EAAIM,OAAOI,aAE5C,IAGHmU,EAAaxT,IAAI,QAAQ,QAAe,CAACrB,EAAKC,KAC5C,MACM6U,EADO9U,EAAIY,KACOe,KAAKC,GACpB,EAAcL,WAAWN,MAC9B,EACA,CAAC,IAAKW,EAAMN,YAAa,IAAIR,KAAQpB,OAAQ,YAAawB,OAAO,CAC/DlB,EAAIM,OAAOC,GACXqB,EAAKrB,QAKXrB,EAAIe,GAAK,IAAM4B,QAAQC,IAAIgT,IAAY,IAGzCD,EAAarT,OAAO,QAAQ,kBAAyB,CAACxB,EAAKC,KACzD,MAAMV,EAAO,CAAC,EACdL,EAAIe,GAAK,IACP,EAAcwB,WAAWR,MACvB,EACA,CAAC1B,GAAM2B,OAAO,CAAClB,EAAIM,OAAOC,GAAIP,EAAIM,OAAOI,aAE5C,IAGHmU,EAAarT,OAAO,QAAQ,QAAe,CAACxB,EAAKC,KAC/C,MACMyB,EADO,IAAI1B,EAAIY,MACGe,KAAKC,GACpB,EAAcH,WAAWR,MAC9B,EACA,CAAC,MAAMC,OAAO,CAAClB,EAAIM,OAAOC,GAAIqB,EAAKrB,QAGvCrB,EAAIe,GAAK,IAAM4B,QAAQC,IAAIJ,IAAY,G,GCvFrCqT,EAA2B,CAAC,EAGhC,SAASC,EAAoBC,GAE5B,IAAIC,EAAeH,EAAyBE,GAC5C,QAAqB7T,IAAjB8T,EACH,OAAOA,EAAalT,QAGrB,IAAID,EAASgT,EAAyBE,GAAY,CAGjDjT,QAAS,CAAC,GAOX,OAHAmT,EAAoBF,GAAUlT,EAAQA,EAAOC,QAASgT,GAG/CjT,EAAOC,OACf,CzDtBIpD,EAAkC,mBAAXwW,OAAwBA,OAAO,kBAAoB,qBAC1EvW,EAAmC,mBAAXuW,OAAwBA,OAAO,mBAAqB,sBAC5EtW,EAAiC,mBAAXsW,OAAwBA,OAAO,iBAAmB,oBACxErW,EAAgBsW,IAChBA,GAASA,EAAMC,EAAI,IACrBD,EAAMC,EAAI,EACVD,EAAME,SAASnW,GAAQA,EAAGoW,MAC1BH,EAAME,SAASnW,GAAQA,EAAGoW,IAAMpW,EAAGoW,IAAMpW,MAC1C,EAyBD4V,EAAoBS,EAAI,CAAC1T,EAAQnB,EAAM8U,KACtC,IAAIL,EACJK,KAAcL,EAAQ,IAAIC,GAAK,GAC/B,IAEIK,EACAC,EACAC,EAJAC,EAAY,IAAIC,IAChB/T,EAAUD,EAAOC,QAIjBgU,EAAU,IAAInU,SAAQ,CAACoU,EAASC,KACnCL,EAASK,EACTN,EAAeK,CAAO,IAEvBD,EAAQnX,GAAkBmD,EAC1BgU,EAAQpX,GAAkBQ,IAAQiW,GAASjW,EAAGiW,GAAQS,EAAUP,QAAQnW,GAAK4W,EAAe,OAAEG,SAC9FpU,EAAOC,QAAUgU,EACjBpV,GAAMwV,IAEL,IAAIhX,EADJuW,EAvCa,CAACS,GAAUA,EAAKzU,KAAK0U,IACnC,GAAW,OAARA,GAA+B,iBAARA,EAAkB,CAC3C,GAAGA,EAAIzX,GAAgB,OAAOyX,EAC9B,GAAGA,EAAI7W,KAAM,CACZ,IAAI6V,EAAQ,GACZA,EAAMC,EAAI,EACVe,EAAI7W,MAAMgW,IACTc,EAAIzX,GAAkB2W,EACtBzW,EAAasW,EAAM,IAChBkB,IACHD,EAAIxX,GAAgByX,EACpBxX,EAAasW,EAAM,IAEpB,IAAIiB,EAAM,CAAC,EAEX,OADAA,EAAI1X,GAAkBQ,GAAQA,EAAGiW,GAC1BiB,CACR,CACD,CACA,IAAIE,EAAM,CAAC,EAGX,OAFAA,EAAI5X,GAAiBuX,MACrBK,EAAI3X,GAAkBwX,EACfG,CAAG,IAkBKC,CAASL,GAEvB,IAAIM,EAAY,IAAOf,EAAYhU,KAAK2T,IACvC,GAAGA,EAAExW,GAAe,MAAMwW,EAAExW,GAC5B,OAAOwW,EAAEzW,EAAe,IAErBmX,EAAU,IAAInU,SAASoU,KAC1B7W,EAAK,IAAO6W,EAAQS,IACjBlB,EAAI,EACP,IAAImB,EAAWC,GAAOA,IAAMvB,IAAUS,EAAUe,IAAID,KAAOd,EAAUlE,IAAIgF,GAAIA,IAAMA,EAAEtB,IAAMlW,EAAGoW,IAAKoB,EAAEE,KAAK1X,KAC1GuW,EAAYhU,KAAK0U,GAASA,EAAIzX,GAAe+X,IAAU,IAExD,OAAOvX,EAAGoW,EAAIQ,EAAUU,GAAW,IAChC7W,IAAUA,EAAMgW,EAAOG,EAAQlX,GAAgBe,GAAO+V,EAAa5T,GAAWjD,EAAasW,MAC/FA,GAASA,EAAMC,EAAI,IAAMD,EAAMC,EAAI,EAAE,E0D9DtCN,EAAoBM,EAAI,CAACtT,EAAS+U,KACjC,IAAI,IAAI9S,KAAO8S,EACX/B,EAAoBgC,EAAED,EAAY9S,KAAS+Q,EAAoBgC,EAAEhV,EAASiC,IAC5EgT,OAAOC,eAAelV,EAASiC,EAAK,CAAEkT,YAAY,EAAMpX,IAAKgX,EAAW9S,IAE1E,ECND+Q,EAAoBgC,EAAI,CAACV,EAAKc,IAAUH,OAAOI,UAAUC,eAAeC,KAAKjB,EAAKc,GCGlF,IAAII,EAAsBxC,EAAoB,K","sources":["webpack://gw-oauth-server/webpack/runtime/async module","webpack://gw-oauth-server/./src/route/application.js","webpack://gw-oauth-server/external commonjs \"path\"","webpack://gw-oauth-server/./src/service/provisioning-service.js","webpack://gw-oauth-server/./src/route/provisionings.js","webpack://gw-oauth-server/external commonjs \"morgan\"","webpack://gw-oauth-server/external commonjs \"jsrsasign\"","webpack://gw-oauth-server/external commonjs \"querystring\"","webpack://gw-oauth-server/external commonjs \"underscore\"","webpack://gw-oauth-server/external commonjs \"underscore.string\"","webpack://gw-oauth-server/./src/helper/utils.js","webpack://gw-oauth-server/./src/service/service-factory.js","webpack://gw-oauth-server/external commonjs \"compression\"","webpack://gw-oauth-server/external commonjs \"randomstring\"","webpack://gw-oauth-server/external commonjs \"express-jwt-permissions\"","webpack://gw-oauth-server/external commonjs \"express\"","webpack://gw-oauth-server/./server.js","webpack://gw-oauth-server/./src/service/application-service.js","webpack://gw-oauth-server/external commonjs \"body-parser\"","webpack://gw-oauth-server/./src/service/code-service.js","webpack://gw-oauth-server/external commonjs \"consolidate\"","webpack://gw-oauth-server/./src/route/users.js","webpack://gw-oauth-server/./src/helper/secure.js","webpack://gw-oauth-server/./src/route/oauth/authorize.js","webpack://gw-oauth-server/external commonjs \"ramda\"","webpack://gw-oauth-server/./src/service/api-service.js","webpack://gw-oauth-server/external commonjs \"buffer\"","webpack://gw-oauth-server/./src/service/remote-path-service.js","webpack://gw-oauth-server/./src/service/authorization-service.js","webpack://gw-oauth-server/./src/route/oauth/auth_service.js","webpack://gw-oauth-server/external commonjs \"cors\"","webpack://gw-oauth-server/./src/service/user-service.js","webpack://gw-oauth-server/./src/service/connection-service.js","webpack://gw-oauth-server/./src/route/connections.js","webpack://gw-oauth-server/./src/route/api.js","webpack://gw-oauth-server/external commonjs \"jwks-rsa\"","webpack://gw-oauth-server/./src/service/company-service.js","webpack://gw-oauth-server/./src/route/companys.js","webpack://gw-oauth-server/external commonjs \"firebase/compat/app\"","webpack://gw-oauth-server/external commonjs \"firebase-admin\"","webpack://gw-oauth-server/external commonjs \"firebase/compat/firestore\"","webpack://gw-oauth-server/external commonjs \"firebase/functions\"","webpack://gw-oauth-server/./src/firebase/firebase-account.js","webpack://gw-oauth-server/external commonjs \"blueimp-md5\"","webpack://gw-oauth-server/./src/firebase/firebase-service.js","webpack://gw-oauth-server/external commonjs \"express-jwt\"","webpack://gw-oauth-server/./src/route/oauth/approve.js","webpack://gw-oauth-server/external commonjs \"dotenv\"","webpack://gw-oauth-server/./src/service/group-service.js","webpack://gw-oauth-server/./src/route/groups.js","webpack://gw-oauth-server/./src/route/oauth/login.js","webpack://gw-oauth-server/external commonjs \"url\"","webpack://gw-oauth-server/./src/route/routes_auth.js","webpack://gw-oauth-server/./src/service/token-service.js","webpack://gw-oauth-server/./src/route/oauth/token.js","webpack://gw-oauth-server/./src/service/domain-service.js","webpack://gw-oauth-server/./src/route/domains.js","webpack://gw-oauth-server/webpack/bootstrap","webpack://gw-oauth-server/webpack/runtime/define property getters","webpack://gw-oauth-server/webpack/runtime/hasOwnProperty shorthand","webpack://gw-oauth-server/webpack/startup"],"sourcesContent":["var webpackQueues = typeof Symbol === \"function\" ? Symbol(\"webpack queues\") : \"__webpack_queues__\";\nvar webpackExports = typeof Symbol === \"function\" ? Symbol(\"webpack exports\") : \"__webpack_exports__\";\nvar webpackError = typeof Symbol === \"function\" ? Symbol(\"webpack error\") : \"__webpack_error__\";\nvar resolveQueue = (queue) => {\n\tif(queue && queue.d < 1) {\n\t\tqueue.d = 1;\n\t\tqueue.forEach((fn) => (fn.r--));\n\t\tqueue.forEach((fn) => (fn.r-- ? fn.r++ : fn()));\n\t}\n}\nvar wrapDeps = (deps) => (deps.map((dep) => {\n\tif(dep !== null && typeof dep === \"object\") {\n\t\tif(dep[webpackQueues]) return dep;\n\t\tif(dep.then) {\n\t\t\tvar queue = [];\n\t\t\tqueue.d = 0;\n\t\t\tdep.then((r) => {\n\t\t\t\tobj[webpackExports] = r;\n\t\t\t\tresolveQueue(queue);\n\t\t\t}, (e) => {\n\t\t\t\tobj[webpackError] = e;\n\t\t\t\tresolveQueue(queue);\n\t\t\t});\n\t\t\tvar obj = {};\n\t\t\tobj[webpackQueues] = (fn) => (fn(queue));\n\t\t\treturn obj;\n\t\t}\n\t}\n\tvar ret = {};\n\tret[webpackQueues] = x => {};\n\tret[webpackExports] = dep;\n\treturn ret;\n}));\n__webpack_require__.a = (module, body, hasAwait) => {\n\tvar queue;\n\thasAwait && ((queue = []).d = -1);\n\tvar depQueues = new Set();\n\tvar exports = module.exports;\n\tvar currentDeps;\n\tvar outerResolve;\n\tvar reject;\n\tvar promise = new Promise((resolve, rej) => {\n\t\treject = rej;\n\t\touterResolve = resolve;\n\t});\n\tpromise[webpackExports] = exports;\n\tpromise[webpackQueues] = (fn) => (queue && fn(queue), depQueues.forEach(fn), promise[\"catch\"](x => {}));\n\tmodule.exports = promise;\n\tbody((deps) => {\n\t\tcurrentDeps = wrapDeps(deps);\n\t\tvar fn;\n\t\tvar getResult = () => (currentDeps.map((d) => {\n\t\t\tif(d[webpackError]) throw d[webpackError];\n\t\t\treturn d[webpackExports];\n\t\t}))\n\t\tvar promise = new Promise((resolve) => {\n\t\t\tfn = () => (resolve(getResult));\n\t\t\tfn.r = 0;\n\t\t\tvar fnQueue = (q) => (q !== queue && !depQueues.has(q) && (depQueues.add(q), q && !q.d && (fn.r++, q.push(fn))));\n\t\t\tcurrentDeps.map((dep) => (dep[webpackQueues](fnQueue)));\n\t\t});\n\t\treturn fn.r ? promise : getResult();\n\t}, (err) => ((err ? reject(promise[webpackError] = err) : outerResolve(exports)), resolveQueue(queue)));\n\tqueue && queue.d < 0 && (queue.d = 0);\n};","import express from \"express\";\r\nimport applicationService from \"../service/application-service.js\";\r\n\r\nconst routerApplication = express.Router();\r\nexport default routerApplication;\r\n\r\nconst appPath = \"application\";\r\n\r\nrouterApplication.get(`/${appPath}/`, (req, res) => {\r\n  if (req.query.condition) {\r\n    run(res, () =>\r\n      applicationService.getApplicationsWhere(\r\n        appPath,\r\n        null,\r\n        null,\r\n        req.query.condition\r\n      )\r\n    );\r\n  } else {\r\n    run(res, () => applicationService.getData(appPath));\r\n  }\r\n});\r\n\r\nrouterApplication.get(`/${appPath}/:id`, (req, res) => {\r\n  run(res, () => applicationService.getData(appPath, req.params.id));\r\n});\r\n\r\nrouterApplication.get(`/:companyId/application`, (req, res) => {\r\n  if (req.query.condition) {\r\n    run(res, () =>\r\n      applicationService.getApplicationsWhere(\r\n        appPath,\r\n        req.params.companyId,\r\n        null,\r\n        req.query.condition\r\n      )\r\n    );\r\n  } else {\r\n    run(res, () =>\r\n      applicationService.getApplications(appPath, req.params.companyId)\r\n    );\r\n  }\r\n});\r\n\r\nrouterApplication.get(`/:companyId/:domainId/application`, (req, res) => {\r\n  if (req.query.condition) {\r\n    run(res, () =>\r\n      applicationService.getApplicationsWhere(\r\n        appPath,\r\n        req.params.companyId,\r\n        req.params.domainId,\r\n        req.query.condition\r\n      )\r\n    );\r\n  } else {\r\n    run(res, () =>\r\n      applicationService.getApplications(\r\n        appPath,\r\n        req.params.companyId,\r\n        req.params.domainId\r\n      )\r\n    );\r\n  }\r\n});\r\n\r\nrouterApplication.post(`/${appPath}/`, (req, res) => {\r\n  const data = {\r\n    ...req.body,\r\n    client_id_created_at: new Date(),\r\n    client_status: \"New\",\r\n  };\r\n  run(\r\n    res,\r\n    () =>\r\n      applicationService.setData.apply(\r\n        applicationService,\r\n        [data].concat([appPath, data.client_id])\r\n      ),\r\n    undefined,\r\n    undefined,\r\n    data\r\n  );\r\n});\r\n\r\nrouterApplication.put(`/${appPath}`, (req, res) => {\r\n  const data = { ...req.body, whenUpdated: new Date(), status: \"Updated\" };\r\n  run(res, () =>\r\n    applicationService.updateData.apply(\r\n      applicationService,\r\n      [data].concat([appPath, data.id])\r\n    )\r\n  );\r\n});\r\n\r\nrouterApplication.put(`/${appPath}/:id`, (req, res) => {\r\n  const data = { ...req.body, whenUpdated: new Date(), status: \"Updated\" };\r\n  run(res, () =>\r\n    applicationService.updateData.apply(\r\n      applicationService,\r\n      [data].concat([appPath, req.params.id])\r\n    )\r\n  );\r\n});\r\n\r\nrouterApplication.delete(`/${appPath}/:id`, (req, res) => {\r\n  const data = {};\r\n  run(res, () =>\r\n    applicationService.deleteData.apply(\r\n      applicationService,\r\n      [data].concat([appPath, req.params.id])\r\n    )\r\n  );\r\n});\r\n\r\nrouterApplication.delete(`/${appPath}`, (req, res) => {\r\n  const data = [...req.body];\r\n  const allDeletes = data.map((item) => {\r\n    return applicationService.deleteData.apply(\r\n      applicationService,\r\n      [null].concat([appPath, item.id])\r\n    );\r\n  });\r\n  run(res, () => Promise.all(allDeletes));\r\n});\r\n\r\n// common functions\r\nfunction run(response, fn, success, error, data) {\r\n  return fn()\r\n    .then((result) =>\r\n      response\r\n        .status(200)\r\n        .send(data ? data : success ? success(result) : result)\r\n    )\r\n    .catch((err) => {\r\n      console.error(err);\r\n      return response.status(500).send(error ? error(err) : err);\r\n    });\r\n}\r\n","module.exports = require(\"path\");","import {provisioningPath} from './remote-path-service.js';\r\nimport {createService} from './service-factory.js';\r\n\r\nexport default createService(provisioningPath);","import express from \"express\";\r\nimport provisioningService from \"../service/provisioning-service.js\";\r\nimport {\r\n  PROVISIONING_COLL,\r\n  generateId,\r\n} from \"../service/remote-path-service.js\";\r\n\r\nconst routerProvisioning = express.Router();\r\nexport default routerProvisioning;\r\n\r\nrouterProvisioning.get(\r\n  `/:id/${PROVISIONING_COLL}/:provisioningId`,\r\n  (req, res) => {\r\n    run(res, () =>\r\n      provisioningService.getData(req.params.id, req.params.provisioningId)\r\n    );\r\n  }\r\n);\r\n\r\nrouterProvisioning.get(`/:id/${PROVISIONING_COLL}`, (req, res) => {\r\n  run(res, () => provisioningService.getData(req.params.id));\r\n});\r\n\r\nrouterProvisioning.post(`/:id/${PROVISIONING_COLL}`, async (req, res) => {\r\n  const data = {\r\n    ...req.body,\r\n    id: generateId(req.body.name),\r\n    whenCreated: new Date(),\r\n    status: \"New\",\r\n  };\r\n\r\n  const provisioning = await provisioningService.getData(\r\n    req.params.id,\r\n    data.id\r\n  );\r\n  if (provisioning.name) {\r\n    console.log(\"provisioning exist\", provisioning);\r\n    return res.status(409).send(\"Item exists\");\r\n  }\r\n\r\n  run(\r\n    res,\r\n    () =>\r\n      provisioningService.setData.apply(\r\n        provisioningService,\r\n        [data].concat([req.params.id, data.id])\r\n      ),\r\n    undefined,\r\n    undefined,\r\n    data\r\n  );\r\n});\r\n\r\nrouterProvisioning.put(\r\n  `/:id/${PROVISIONING_COLL}/:provisioningId`,\r\n  (req, res) => {\r\n    const data = { ...req.body, whenUpdated: new Date(), status: \"Updated\" };\r\n    run(res, () =>\r\n      provisioningService.updateData.apply(\r\n        provisioningService,\r\n        [data].concat([req.params.id, req.params.provisioningId])\r\n      )\r\n    );\r\n  }\r\n);\r\n\r\nrouterProvisioning.delete(\r\n  `/:id/${PROVISIONING_COLL}/:provisioningId`,\r\n  (req, res) => {\r\n    const data = {};\r\n    run(res, () =>\r\n      provisioningService.deleteData.apply(\r\n        provisioningService,\r\n        [data].concat([req.params.id, req.params.provisioningId])\r\n      )\r\n    );\r\n  }\r\n);\r\n\r\n// common functions\r\nfunction run(response, fn, success, error, data) {\r\n  return fn()\r\n    .then((result) =>\r\n      response\r\n        .status(200)\r\n        .send(data ? data : success ? success(result) : result)\r\n    )\r\n    .catch((err) => {\r\n      console.error(err);\r\n      return response.status(500).send(error ? error(err) : err);\r\n    });\r\n}\r\n","module.exports = require(\"morgan\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"jsrsasign\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"querystring\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"underscore\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"underscore.string\");","import url from 'url';\r\nimport jose from 'jsrsasign';\r\nimport randomstring from 'randomstring';\r\nimport querystring from 'querystring';\r\nimport * as __ from 'underscore';\r\nimport __string from 'underscore.string';\r\n\r\nimport rsaKey from '../route/rsaKey.json' with { type: \"json\" };\r\n\r\nexport const generateAccessToken = (iss, sub, aud, iat, exp, permissions) => {\r\n    var header = { 'typ': 'JWT', 'alg': rsaKey.alg, 'kid': rsaKey.kid };\r\n    var payload = {\r\n        iss: iss,\r\n        sub: sub,\r\n        aud: aud,\r\n        iat: iat,\r\n        exp: exp,\r\n        jti: randomstring.generate(8),\r\n        permissions: permissions\r\n    };\r\n   \r\n    var privateKey = jose.KEYUTIL.getKey(rsaKey);\r\n    var access_token = jose.jws.JWS.sign(header.alg,\r\n        JSON.stringify(header),\r\n        JSON.stringify(payload),\r\n        privateKey);\r\n\r\n    return access_token;\r\n}\r\n\r\nexport const buildUrl = (base, options, hash) => {\r\n\tvar newUrl = url.parse(base, true);\r\n\tdelete newUrl.search;\r\n\tif (!newUrl.query) {\r\n\t\tnewUrl.query = {};\r\n\t}\r\n\t__.each(options, function(value, key) {\r\n\t\tnewUrl.query[key] = value;\r\n\t});\r\n\tif (hash) {\r\n\t\tnewUrl.hash = hash;\r\n\t}\r\n\t\r\n\treturn url.format(newUrl);\r\n};\r\n\r\nexport const decodeClientCredentials = function(auth) {\r\n\tvar clientCredentials = Buffer.from(auth.slice('basic '.length), 'base64').toString().split(':');\r\n\tvar clientId = querystring.unescape(clientCredentials[0]);\r\n\tvar clientSecret = querystring.unescape(clientCredentials[1]);\t\r\n\treturn { id: clientId, secret: clientSecret };\r\n};\r\n\r\nexport const getScopesFromForm = function(body) {\r\n\treturn __.filter(__.keys(body), function(s) { return __string.startsWith(s, 'scope_'); })\r\n\t\t\t\t.map(function(s) { return s.slice('scope_'.length); });\r\n};","import * as R from \"ramda\";\r\nimport {\r\n  getDoc,\r\n  geChildtDoc,\r\n  getCollectionCount,\r\n  setDoc,\r\n  addDoc,\r\n  updateDoc,\r\n  deleteDoc,\r\n} from \"../firebase/firebase-service.js\";\r\n\r\nexport const createService = (pathFn) => {\r\n  console.log(\"pathFn\", pathFn, pathFn());\r\n  return {\r\n    getPath: pathFn,\r\n    getData: R.compose(getDoc, pathFn),\r\n    getChildData: R.compose(geChildtDoc, pathFn),\r\n    getDataCount: R.compose(getCollectionCount, pathFn),\r\n    setData: (data, ...ids) => setDoc(pathFn.apply(null, ids), data),\r\n    addData: (data, ...ids) => addDoc(pathFn.apply(null, ids), data),\r\n    updateData: (data, ...ids) => updateDoc(pathFn.apply(null, ids), data),\r\n    deleteData: (data, ...ids) => deleteDoc(pathFn.apply(null, ids), data),\r\n    getDataByPath: (dataPath) => getDoc(dataPath),\r\n    setDataByPath: (dataPath, data) => setDoc(dataPath, data),\r\n    deleteDataByPath: (dataPath) => deleteDoc(dataPath),\r\n  };\r\n};\r\n","module.exports = require(\"compression\");","module.exports = require(\"randomstring\");","module.exports = require(\"express-jwt-permissions\");","module.exports = require(\"express\");","import express from \"express\";\r\nimport cors from \"cors\";\r\nimport path from \"path\";\r\nimport { fileURLToPath } from \"url\";\r\nimport bodyParser from \"body-parser\";\r\nimport cons from \"consolidate\";\r\nimport routerAuth from \"./src/route/routes_auth.js\";\r\nimport logger from \"morgan\";\r\nimport { expressjwt } from \"express-jwt\";\r\nimport guard from \"express-jwt-permissions\";\r\nimport jwks from \"jwks-rsa\";\r\nimport compression from \"compression\";\r\nimport dotenv from \"dotenv\";\r\ndotenv.config(); //{ path: \".env.development\" });\r\n\r\nimport routerConnection from \"./src/route/connections.js\";\r\nimport routerDomain from \"./src/route/domains.js\";\r\nimport routerCompany from \"./src/route/companys.js\";\r\nimport routerGroup from \"./src/route/groups.js\";\r\nimport routerUser from \"./src/route/users.js\";\r\nimport routerProvisioning from \"./src/route/provisionings.js\";\r\nimport routerApplication from \"./src/route/application.js\";\r\nimport routerApi from \"./src/route/api.js\";\r\nimport { COMPANY_COLL } from \"./src/service/remote-path-service.js\";\r\n\r\nconst isProduction = process.env.NODE_ENV === \"production\";\r\nconst __filename = fileURLToPath(import.meta.url);\r\nconst __dirname = path.dirname(__filename);\r\nconst oauth_server_path = path.join(__dirname, \"./src/oauth-server\");\r\n\r\nexport const app = express();\r\n\r\nconst Guard = guard({\r\n  requestProperty: \"auth\",\r\n  permissionsProperty: \"permissions\",\r\n});\r\n\r\nconst jwtCheck = expressjwt({\r\n  secret: jwks.expressJwtSecret({\r\n    cache: true,\r\n    rateLimit: true,\r\n    jwksRequestsPerMinute: 5,\r\n    jwksUri:\r\n      \"https://gw-oauth-server-hcf3ceajdpg2gcbg.canadacentral-01.azurewebsites.net/jwks.json\",\r\n  }),\r\n  audience: \"http://unidir.api.igoodworks.com/\",\r\n  issuer: \"http://oauth.unidir.igoodworks.com/\",\r\n  algorithms: [\"RS256\"],\r\n});\r\n\r\n// const jwtCheckService = expressjwt({\r\n//   secret: jwks.expressJwtSecret({\r\n//     cache: true,\r\n//     rateLimit: true,\r\n//     jwksRequestsPerMinute: 5,\r\n//     jwksUri:\r\n//       \"https://gw-oauth-server-hcf3ceajdpg2gcbg.canadacentral-01.azurewebsites.net/jwks.json\",\r\n//   }),\r\n//   audience: \"http://service.unidir.api.igoodworks.com/\",\r\n//   issuer: \"http://service.oauth.unidir.igoodworks.com/\",\r\n//   algorithms: [\"RS256\"],\r\n// });\r\n\r\nif (isProduction) {\r\n  console.log(\"production\");\r\n  app.use(compression());\r\n}\r\n\r\n// const corsOptions = {\r\n//   origin: \"http://localhost:3000\",\r\n//   credentials: true, //access-control-allow-credentials:true\r\n//   optionSuccessStatus: 200,\r\n// };\r\napp.use(cors());\r\napp.use(logger(\"dev\"));\r\n\r\napp.use(bodyParser.urlencoded({ extended: true })); // support form-encoded bodies (for the token endpoint)\r\napp.use(bodyParser.json());\r\n\r\napp.engine(\"html\", cons.underscore);\r\napp.set(\"view engine\", \"html\");\r\napp.set(\"views\", oauth_server_path);\r\napp.set(\"json spaces\", 4);\r\n\r\ntry {\r\n  app.use(\"/oauth/\", routerAuth);\r\n\r\n  app.use(\r\n    `/oauthapi/`,\r\n    jwtCheck,\r\n    Guard.check([\"openId\"]),\r\n    routerApplication,\r\n    routerApi\r\n  );\r\n  app.use(\r\n    `/api/${COMPANY_COLL}`,\r\n    jwtCheck,\r\n    Guard.check([[\"user:admin\"], [\"service\"]]),\r\n    routerCompany,\r\n    routerDomain,\r\n    routerGroup,\r\n    routerUser,\r\n    routerConnection,\r\n    routerProvisioning\r\n  );\r\n} catch (error) {\r\n  console.log(\"authentication retuns error:\", error);\r\n}\r\n\r\napp.use(express.static(oauth_server_path));\r\napp.get(\"*\", (req, res) => {\r\n  res.sendFile(path.join(oauth_server_path, \"index.html\"));\r\n});\r\n\r\nconst hostheader = isProduction ? \"\" : \"localhost\";\r\nconst port = isProduction ? process.env.SERVER_PORT : 80;\r\nconsole.log(\"hostheader, port, isProduction\", hostheader, port, isProduction);\r\nconst server = app.listen(port || 8080, hostheader, () => {\r\n  const host = server.address().address;\r\n  const port = server.address().port;\r\n\r\n  console.log(\r\n    \"OAuth Authorization Server is listening at http://%s:%s\",\r\n    host,\r\n    port\r\n  );\r\n});\r\n\r\n/*\r\nconst cookieParser = require('cookie-parser');\r\nconst crypto = require('crypto');\r\n\r\napp.use(cookieParser()); //    \r\n\r\n// XSRF-TOKEN  \r\nconst generateXsrfToken = () => {\r\n  return crypto.randomBytes(32).toString('hex'); // 32    \r\n};\r\n\r\n//  XSRF-TOKEN   \r\napp.use((req, res, next) => {\r\n  if (!req.cookies['XSRF-TOKEN']) {\r\n    const token = generateXsrfToken();\r\n    res.cookie('XSRF-TOKEN', token, {\r\n      httpOnly: false, //     (JS   )\r\n      secure: process.env.NODE_ENV === 'production', // HTTPS   \r\n      sameSite: 'Strict', // CSRF    SameSite  \r\n    });\r\n  }\r\n  next();\r\n});\r\n*/\r\n","import { applicationPath } from \"./remote-path-service.js\";\r\nimport { createService } from \"./service-factory.js\";\r\nimport { getDoc } from \"../firebase/firebase-service.js\";\r\n\r\nconst getRedirectURIs = (authId, appid) =>\r\n  getDoc(`${applicationPath(authId, appid)}/redirect_uris`, null);\r\n\r\nconst getApplications = (appPath, companyId, domainId) =>\r\n  getDoc(\r\n    applicationPath(appPath),\r\n    domainId == undefined\r\n      ? [\"companyId\", \"==\", companyId]\r\n      : [\r\n          [\"companyId\", \"==\", companyId],\r\n          [\"domain\", \"==\", domainId],\r\n        ]\r\n  );\r\nconst getApplicationsWhere = (appPath, companyId, domainId, condition) => {\r\n  const fullCondition = domainId\r\n    ? [[\"companyId\", \"==\", companyId], [\"domain\", \"==\", domainId], condition]\r\n    : companyId\r\n    ? [[\"companyId\", \"==\", companyId], condition]\r\n    : condition;\r\n  return getDoc(applicationPath(appPath), fullCondition);\r\n};\r\n\r\nexport default {\r\n  ...createService(applicationPath),\r\n  getRedirectURIs,\r\n  getApplications,\r\n  getApplicationsWhere,\r\n};\r\n","module.exports = require(\"body-parser\");","import {authCodePath} from './remote-path-service.js';\r\nimport {createService} from './service-factory.js';\r\n\r\nexport default createService(authCodePath);\r\n","module.exports = require(\"consolidate\");","import express from \"express\";\r\nimport userService from \"../service/user-service.js\";\r\nimport {\r\n  DOMAIN_COLL,\r\n  USER_COLL,\r\n  generateId,\r\n} from \"../service/remote-path-service.js\";\r\n\r\nconst routerUser = express.Router();\r\nexport default routerUser;\r\n\r\nrouterUser.get(`/:id/${DOMAIN_COLL}/:domainId/${USER_COLL}`, (req, res) => {\r\n  console.log(\"req.query\", req.query);\r\n  if (req.query.condition) {\r\n    run(res, () =>\r\n      userService.getUsersWhere(\r\n        req.params.id,\r\n        req.params.domainId,\r\n        req.query.condition\r\n      )\r\n    );\r\n  } else {\r\n    run(res, () => userService.getData(req.params.id, req.params.domainId));\r\n  }\r\n});\r\n\r\nrouterUser.get(\r\n  `/:id/${DOMAIN_COLL}/:domainId/${USER_COLL}/:userId`,\r\n  (req, res) => {\r\n    run(res, () =>\r\n      userService.getData(req.params.id, req.params.domainId, req.params.userId)\r\n    );\r\n  }\r\n);\r\n\r\nrouterUser.post(\r\n  `/:id/${DOMAIN_COLL}/:domainId/${USER_COLL}`,\r\n  async (req, res) => {\r\n    const data = {\r\n      ...req.body,\r\n      id: generateId(req.body.username),\r\n      whenCreated: new Date(),\r\n      status: \"new\",\r\n    };\r\n\r\n    const user = await userService.getData(\r\n      req.params.id,\r\n      req.params.domainId,\r\n      data.id\r\n    );\r\n    if (user.name) {\r\n      console.log(\"user exist\", user);\r\n      return res.status(409).send(\"Item exists\");\r\n    }\r\n\r\n    run(\r\n      res,\r\n      () =>\r\n        userService.setData.apply(\r\n          userService,\r\n          [data].concat([req.params.id, req.params.domainId, data.id])\r\n        ),\r\n      undefined,\r\n      undefined,\r\n      data\r\n    );\r\n  }\r\n);\r\n\r\nrouterUser.put(\r\n  `/:id/${DOMAIN_COLL}/:domainId/${USER_COLL}/:userId`,\r\n  (req, res) => {\r\n    const data = { ...req.body, whenUpdated: new Date() };\r\n    run(res, () =>\r\n      userService.updateData.apply(\r\n        userService,\r\n        [data].concat([req.params.id, req.params.domainId, req.params.userId])\r\n      )\r\n    );\r\n  }\r\n);\r\n\r\nrouterUser.put(`/:id/${DOMAIN_COLL}/:domainId/${USER_COLL}`, (req, res) => {\r\n  const data = [...req.body];\r\n  const allUpdates = data.map((item) => {\r\n    return userService.updateData.apply(\r\n      userService,\r\n      [{ ...item, whenUpdated: new Date() }].concat([\r\n        req.params.id,\r\n        req.params.domainId,\r\n        item.id,\r\n      ])\r\n    );\r\n  });\r\n  run(res, () => Promise.all(allUpdates));\r\n});\r\n\r\nrouterUser.delete(\r\n  `/:id/${DOMAIN_COLL}/:domainId/${USER_COLL}/:userId`,\r\n  (req, res) => {\r\n    run(res, () =>\r\n      userService.deleteData.apply(\r\n        userService,\r\n        [{}].concat([req.params.id, req.params.domainId, req.params.userId])\r\n      )\r\n    );\r\n  }\r\n);\r\n\r\nrouterUser.delete(`/:id/${DOMAIN_COLL}/:domainId/${USER_COLL}`, (req, res) => {\r\n  const data = [...req.body];\r\n  const allDeletes = data.map((item) => {\r\n    return userService.deleteData.apply(\r\n      userService,\r\n      [null].concat([req.params.id, req.params.domainId, item.id])\r\n    );\r\n  });\r\n  run(res, () => Promise.all(allDeletes));\r\n});\r\n\r\n// common functions\r\nfunction run(response, fn, success, error, data) {\r\n  return fn()\r\n    .then((result) =>\r\n      response\r\n        .status(200)\r\n        .send(data ? data : success ? success(result) : result)\r\n    )\r\n    .catch((err) => {\r\n      console.error(err);\r\n      return response.status(500).send(error ? error(err) : err);\r\n    });\r\n}\r\n","import dotenv from \"dotenv\";\r\ndotenv.config(); //{ path: \".env.development\" });\r\n\r\nfunction arrayBufferToHex(buffer) {\r\n  return [...new Uint8Array(buffer)]\r\n    .map((byte) => byte.toString(16).padStart(2, \"0\"))\r\n    .join(\"\");\r\n}\r\n\r\nfunction hexToArrayBuffer(hex) {\r\n  const bytes = new Uint8Array(hex.length / 2);\r\n  for (let i = 0; i < hex.length; i += 2) {\r\n    bytes[i / 2] = parseInt(hex.substr(i, 2), 16);\r\n  }\r\n  return bytes.buffer;\r\n}\r\n\r\nasync function getCryptoKey(password) {\r\n  const encoder = new TextEncoder();\r\n  const keyMaterial = encoder.encode(password);\r\n  return crypto.subtle.importKey(\r\n    \"raw\",\r\n    keyMaterial,\r\n    { name: \"PBKDF2\" },\r\n    false,\r\n    [\"deriveKey\"]\r\n  );\r\n}\r\n\r\nasync function deriveKey(password, salt) {\r\n  const keyMaterial = await getCryptoKey(password);\r\n  return crypto.subtle.deriveKey(\r\n    {\r\n      name: \"PBKDF2\",\r\n      salt: salt,\r\n      iterations: 100000,\r\n      hash: \"SHA-256\",\r\n    },\r\n    keyMaterial,\r\n    { name: \"AES-GCM\", length: 256 },\r\n    false,\r\n    [\"encrypt\", \"decrypt\"]\r\n  );\r\n}\r\n\r\nexport async function encryptText(text, password) {\r\n  const encoder = new TextEncoder();\r\n  const salt = crypto.getRandomValues(new Uint8Array(16));\r\n  const iv = crypto.getRandomValues(new Uint8Array(12));\r\n  const key = await deriveKey(password, salt);\r\n\r\n  const encrypted = await crypto.subtle.encrypt(\r\n    { name: \"AES-GCM\", iv: iv },\r\n    key,\r\n    encoder.encode(text)\r\n  );\r\n\r\n  return {\r\n    cipherText: arrayBufferToHex(encrypted),\r\n    iv: arrayBufferToHex(iv),\r\n    salt: arrayBufferToHex(salt),\r\n  };\r\n}\r\n\r\nexport async function decryptText(encryptedData, password) {\r\n  const { cipherText, iv, salt } = encryptedData;\r\n  const key = await deriveKey(password, hexToArrayBuffer(salt));\r\n\r\n  const decrypted = await crypto.subtle.decrypt(\r\n    { name: \"AES-GCM\", iv: hexToArrayBuffer(iv) },\r\n    key,\r\n    hexToArrayBuffer(cipherText)\r\n  );\r\n\r\n  const decoder = new TextDecoder();\r\n  return decoder.decode(decrypted);\r\n}\r\n\r\nexport async function buildQueryUrl(baseUrl, params) {\r\n  const encripedParams = await encryptText(\r\n    JSON.stringify(params),\r\n    process.env.ENCRIPTION_PASSWORD\r\n  );\r\n\r\n  return `${baseUrl}?d=${encripedParams.cipherText}&i=${encripedParams.iv}&s=${encripedParams.salt}`;\r\n}\r\n","import * as R from \"ramda\";\r\nimport { getClient, verifyUser } from \"./auth_service.js\";\r\nimport randomstring from \"randomstring\";\r\nimport { buildUrl } from \"../../helper/utils.js\";\r\nimport { buildQueryUrl } from \"../../helper/secure.js\";\r\nasync function authorize(req, res, routerAuth) {\r\n  let client = null;\r\n  if (R.includes(\"openId\", req.query.scope.split(\" \"))) {\r\n    if (!req.query.email && !req.query.password) {\r\n      //const urlParsed = buildUrl(\"../login\", req.query);\r\n      const params = {\r\n        client_id: req.query.client_id,\r\n        redirect_uri: req.query.redirect_uri,\r\n        scope: req.query.scope,\r\n        state: req.query.state,\r\n      };\r\n      const redirectURL = await buildQueryUrl(\"../login\", params);\r\n      res.redirect(redirectURL);\r\n\r\n      return;\r\n    } else {\r\n      client = await getClient(req.query.client_id);\r\n\r\n      const isVerified = await verifyUser(\r\n        client.companyId,\r\n        client.domain,\r\n        req.query.email,\r\n        req.query.password\r\n      );\r\n\r\n      if (!isVerified) {\r\n        const params = {\r\n          client_id: req.query.client_id,\r\n          redirect_uri: req.query.redirect_uri,\r\n          scope: req.query.scope,\r\n          state: req.query.state,\r\n        };\r\n        const redirectURL = await buildQueryUrl(\"../login\", params);\r\n        res.redirect(redirectURL);\r\n\r\n        return;\r\n      }\r\n    }\r\n  } else {\r\n    client = await getClient(req.query.client_id);\r\n  }\r\n\r\n  if (!client) {\r\n    console.log(\"Unknown client %s\", req.query.client_id);\r\n    res.render(\"error\", { error: \"Unknown client\" });\r\n    return;\r\n  } else if (!R.includes(req.query.redirect_uri, client.redirect_uris)) {\r\n    console.log(\r\n      \"Mismatched redirect URI, expected %s got %s\",\r\n      client.redirect_uris,\r\n      req.query.redirect_uri\r\n    );\r\n    res.render(\"error\", { error: \"Invalid redirect URI\" });\r\n    return;\r\n  } else {\r\n    const rscope = req.query.scope ? req.query.scope.split(\" \") : undefined;\r\n\r\n    if (R.difference(rscope, client.scope).length > 0) {\r\n      const urlParsed = buildUrl(req.query.redirect_uri, {\r\n        error: \"invalid_scope\",\r\n      });\r\n      res.redirect(urlParsed);\r\n      return;\r\n    }\r\n\r\n    const reqid = randomstring.generate(8);\r\n\r\n    //const requests = [{reqid:req.query}];\r\n    routerAuth.locals.requests[reqid] = req.query;\r\n\r\n    const params = {\r\n      client: client,\r\n      reqid: reqid,\r\n      scope: rscope,\r\n      email: req.query.email,\r\n    };\r\n    const redirectURL = await buildQueryUrl(\"../approve\", params);\r\n    res.redirect(redirectURL);\r\n\r\n    return;\r\n  }\r\n}\r\n\r\nexport default authorize;\r\n","module.exports = require(\"ramda\");","import { apiPath } from \"./remote-path-service.js\";\r\nimport { createService } from \"./service-factory.js\";\r\nimport { getDoc } from \"../firebase/firebase-service.js\";\r\n\r\nconst getApiByIdentifier = (authId, identifier) =>\r\n  getDoc(`${apiPath(authId, \"\")}`, [\"identifier\", \"==\", identifier]);\r\n\r\nconst getApis = (apiPartialPath, companyId, domainId) =>\r\n  getDoc(\r\n    apiPath(apiPartialPath),\r\n    domainId == undefined\r\n      ? [\"companyId\", \"==\", companyId]\r\n      : [\r\n          [\"companyId\", \"==\", companyId],\r\n          [\"domain\", \"==\", domainId],\r\n        ]\r\n  );\r\nconst getApisWhere = (apiPartialPath, companyId, domainId, condition) => {\r\n  const fullCondition = domainId\r\n    ? [[\"companyId\", \"==\", companyId], [\"domain\", \"==\", domainId], condition]\r\n    : companyId\r\n    ? [[\"companyId\", \"==\", companyId], condition]\r\n    : condition;\r\n  return getDoc(apiPartialPath(apiPartialPath), fullCondition);\r\n};\r\nconst getApiPermissionScopes = (apiPartialPath, apiId) =>\r\n  getDoc(apiPath(apiPartialPath, apiId, \"PermissionScopes\"), null);\r\n\r\nexport default {\r\n  ...createService(apiPath),\r\n  getApis,\r\n  getApisWhere,\r\n  getApiPermissionScopes,\r\n  getApiByIdentifier,\r\n};\r\n","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"buffer\");","import * as R from \"ramda\";\r\nimport { Blob } from \"buffer\";\r\n\r\nexport const AUTH_COLL = \"Auth2\";\r\nexport const API_COLL = \"registers\";\r\nexport const APPLICATION_COLL = \"registers\";\r\nexport const CODE_COLL = \"codes\";\r\nexport const TOKEN_COLL = \"tokens\";\r\n\r\nexport const COMPANY_COLL = \"companys\";\r\nexport const DOMAIN_COLL = \"domainNames\";\r\nexport const GROUP_COLL = \"groups\";\r\nexport const USER_COLL = \"users\";\r\nexport const PROVISIONING_COLL = \"provisionings\";\r\n\r\nexport const PRODUCT_COLL = \"products\";\r\nexport const COMPUTER_COLL = \"computers\";\r\nexport const CONNECTION_COLL = \"connections\";\r\nexport const SYNC_COLL = \"syncronizations\";\r\nexport const ACCOUNT_COLL = \"accounts\";\r\n\r\nconst concat = (...param) =>\r\n  param.reduce((acc, cur) => R.concat(acc, cur ? `/${cur}` : \"\"));\r\n\r\nexport const companyPath = (companyId) => concat(COMPANY_COLL, companyId);\r\nexport const domainPath = (companyId, domainId) =>\r\n  concat(companyPath(companyId), DOMAIN_COLL, domainId);\r\nexport const groupPath = (companyId, domainId, groupId, memberPath, memberId) =>\r\n  concat(\r\n    domainPath(companyId, domainId),\r\n    GROUP_COLL,\r\n    groupId,\r\n    memberPath,\r\n    memberId\r\n  );\r\nexport const userPath = (companyId, domainId, userId) =>\r\n  concat(domainPath(companyId, domainId), USER_COLL, userId);\r\nexport const provisioningPath = (companyId, provisioningId) =>\r\n  concat(companyPath(companyId), PROVISIONING_COLL, provisioningId);\r\n\r\nexport const productPath = (companyId, productId) =>\r\n  concat(companyPath(companyId), PRODUCT_COLL, productId);\r\nexport const connectionPath = (companyId, provisioningId, connectionId) =>\r\n  concat(\r\n    provisioningPath(companyId, provisioningId),\r\n    CONNECTION_COLL,\r\n    connectionId\r\n  );\r\nexport const syncronizationPath = (companyId, syncId) =>\r\n  concat(companyPath(companyId), SYNC_COLL, syncId);\r\nexport const computerPath = (companyId, domainId, computerId) =>\r\n  concat(domainPath(companyId, domainId), COMPUTER_COLL, computerId);\r\nexport const accountPath = (email) => concat(ACCOUNT_COLL, email);\r\n\r\nexport const authPath = (authId) => concat(AUTH_COLL, authId);\r\nexport const apiPath = (authId, apiId, scopePath, scopeId) =>\r\n  concat(authPath(authId), API_COLL, apiId, scopePath, scopeId);\r\nexport const applicationPath = (authId, appId) =>\r\n  concat(authPath(authId), APPLICATION_COLL, appId);\r\nexport const authCodePath = (authId, codeId) =>\r\n  concat(authPath(authId), CODE_COLL, codeId);\r\nexport const tokenPath = (authId, token) =>\r\n  concat(authPath(authId), TOKEN_COLL, token);\r\n\r\nexport const generateId = (id) => {\r\n  const reg = new RegExp(`.{1,${id.length}}`);\r\n  let guid = URL.createObjectURL(new Blob([])).slice(-36);\r\n  return guid.replace(reg, id);\r\n};\r\n","import {authPath} from './remote-path-service.js';\r\nimport {createService} from './service-factory.js';\r\n\r\nexport default createService(authPath);\r\n","import userService from \"../../service/user-service.js\";\r\nimport applicationService from \"../../service/application-service.js\";\r\nimport authService from \"../../service/authorization-service.js\";\r\n\r\nconst authId = \"authorization\";\r\nconst appId = \"application\";\r\n\r\nexport const authData = async () => {\r\n  return await authService.getData(authId);\r\n};\r\n\r\nexport const getUser = async (companyId, domainName, email) => {\r\n  const users = await userService.getUserByEmail(companyId, domainName, email);\r\n  let user = null;\r\n  if (users.length == 1) {\r\n    user = users[0];\r\n  }\r\n\r\n  return user;\r\n};\r\n\r\nexport const verifyUser = async (companyId, domainName, email, password) => {\r\n  const isVerified = await userService.userVerification(\r\n    companyId,\r\n    domainName,\r\n    email,\r\n    password\r\n  );\r\n\r\n  return isVerified;\r\n};\r\n\r\nexport const getClient = async (clientId) => {\r\n  let appData = await applicationService.getData(appId, clientId);\r\n\r\n  if (appData.client_id == undefined) return null;\r\n\r\n  return appData;\r\n};\r\n","module.exports = require(\"cors\");","import { userPath } from \"./remote-path-service.js\";\r\nimport { createService } from \"./service-factory.js\";\r\nimport { verifyUser, getDoc } from \"../firebase/firebase-service.js\";\r\n\r\nconst userVerification = (companyId, domainId, email, password) =>\r\n  verifyUser(userPath(companyId, domainId), password, [\"email\", \"==\", email]);\r\nconst getUserByEmail = (companyId, domainId, email) =>\r\n  getDoc(userPath(companyId, domainId), [\"email\", \"==\", email]);\r\nconst getUsersWhere = (companyId, domainId, condition) =>\r\n  getDoc(userPath(companyId, domainId), condition);\r\n\r\nexport default {\r\n  ...createService(userPath),\r\n  userVerification,\r\n  getUserByEmail,\r\n  getUsersWhere,\r\n};\r\n","import {connectionPath} from './remote-path-service.js';\r\nimport {createService} from './service-factory.js';\r\n\r\nexport default createService(connectionPath);","import express from \"express\";\r\nimport connectionService from \"../service/connection-service.js\";\r\nimport {\r\n  CONNECTION_COLL,\r\n  PROVISIONING_COLL,\r\n  generateId,\r\n} from \"../service/remote-path-service.js\";\r\n\r\nconst routerConnection = express.Router();\r\nexport default routerConnection;\r\n\r\nrouterConnection.get(\r\n  `/:id/${PROVISIONING_COLL}/:provisioningId/${CONNECTION_COLL}/:connectionId`,\r\n  (req, res) => {\r\n    run(res, () =>\r\n      connectionService.getData(\r\n        req.params.id,\r\n        req.params.provisioningId,\r\n        req.params.connectionId\r\n      )\r\n    );\r\n  }\r\n);\r\n\r\nrouterConnection.get(\r\n  `/:id/${PROVISIONING_COLL}/:provisioningId/${CONNECTION_COLL}`,\r\n  (req, res) => {\r\n    run(res, () =>\r\n      connectionService.getData(req.params.id, req.params.provisioningId)\r\n    );\r\n  }\r\n);\r\n\r\nrouterConnection.post(\r\n  `/:id/${PROVISIONING_COLL}/:provisioningId/${CONNECTION_COLL}`,\r\n  async (req, res) => {\r\n    const data = {\r\n      ...req.body,\r\n      id: generateId(req.body.name),\r\n      whenCreated: new Date(),\r\n      enabled: false,\r\n      status: \"New\",\r\n    };\r\n\r\n    const connection = await connectionService.getData(\r\n      req.params.id,\r\n      req.params.provisioningId,\r\n      data.id\r\n    );\r\n    if (connection.name) {\r\n      console.log(\"connection exist\", connection);\r\n      return res.status(409).send(\"Item exists\");\r\n    }\r\n\r\n    run(\r\n      res,\r\n      () =>\r\n        connectionService.setData.apply(\r\n          connectionService,\r\n          [data].concat([req.params.id, req.params.provisioningId, data.id])\r\n        ),\r\n      undefined,\r\n      undefined,\r\n      data\r\n    );\r\n  }\r\n);\r\n\r\nrouterConnection.put(\r\n  `/:id/${PROVISIONING_COLL}/:provisioningId/${CONNECTION_COLL}/:connectionId`,\r\n  (req, res) => {\r\n    const data = {\r\n      ...req.body,\r\n      whenUpdated: new Date(),\r\n      enabled: true,\r\n      status: \"Updated\",\r\n    };\r\n    run(res, () =>\r\n      connectionService.updateData.apply(\r\n        connectionService,\r\n        [data].concat([\r\n          req.params.id,\r\n          req.params.provisioningId,\r\n          req.params.connectionId,\r\n        ])\r\n      )\r\n    );\r\n  }\r\n);\r\n\r\nrouterConnection.delete(\r\n  `/:id/${PROVISIONING_COLL}/:provisioningId/${CONNECTION_COLL}/:connectionId`,\r\n  (req, res) => {\r\n    const data = {};\r\n    run(res, () =>\r\n      connectionService.deleteData.apply(\r\n        connectionService,\r\n        [data].concat([\r\n          req.params.id,\r\n          req.params.provisioningId,\r\n          req.params.connectionId,\r\n        ])\r\n      )\r\n    );\r\n  }\r\n);\r\n\r\n// common functions\r\nfunction run(response, fn, success, error, data) {\r\n  return fn()\r\n    .then((result) =>\r\n      response\r\n        .status(200)\r\n        .send(data ? data : success ? success(result) : result)\r\n    )\r\n    .catch((err) => {\r\n      console.error(err);\r\n      return response.status(500).send(error ? error(err) : err);\r\n    });\r\n}\r\n","import express from \"express\";\r\nimport apiService from \"../service/api-service.js\";\r\n\r\nconst routerApi = express.Router();\r\nexport default routerApi;\r\n\r\nconst apiPath = \"api\";\r\n\r\nrouterApi.get(`/${apiPath}/`, (req, res) => {\r\n  if (req.query.condition) {\r\n    run(res, () =>\r\n      apiService.getApisWhere(apiPath, null, null, req.query.condition)\r\n    );\r\n  } else {\r\n    run(res, () => apiService.getData(apiPath));\r\n  }\r\n});\r\n\r\nrouterApi.get(`/${apiPath}/:id`, (req, res) => {\r\n  run(res, () => apiService.getData(apiPath, req.params.id));\r\n});\r\n\r\nrouterApi.get(`/${apiPath}/:id/PermissionScopes`, (req, res) => {\r\n  run(res, () => apiService.getApiPermissionScopes(apiPath, req.params.id));\r\n});\r\n\r\nrouterApi.get(`/:companyId/api`, (req, res) => {\r\n  run(res, () => apiService.getApis(apiPath, req.params.companyId));\r\n  if (req.query.condition) {\r\n    run(res, () =>\r\n      apiService.getApisWhere(\r\n        apiPath,\r\n        req.params.companyId,\r\n        null,\r\n        req.query.condition\r\n      )\r\n    );\r\n  } else {\r\n    run(res, () => apiService.getApis(apiPath, req.params.companyId));\r\n  }\r\n});\r\n\r\nrouterApi.get(`/:companyId/:domainId/api`, (req, res) => {\r\n  if (req.query.condition) {\r\n    run(res, () =>\r\n      apiService.getApisWhere(\r\n        apiPath,\r\n        req.params.companyId,\r\n        req.params.domainId,\r\n        req.query.condition\r\n      )\r\n    );\r\n  } else {\r\n    run(res, () =>\r\n      apiService.getApis(apiPath, req.params.companyId, req.params.domainId)\r\n    );\r\n  }\r\n});\r\n\r\nrouterApi.post(`/${apiPath}/`, (req, res) => {\r\n  const data = { ...req.body, whenCreated: new Date(), status: \"New\" };\r\n  run(\r\n    res,\r\n    () =>\r\n      apiService.setData.apply(apiService, [data].concat([apiPath, data.id])),\r\n    undefined,\r\n    undefined,\r\n    data\r\n  );\r\n});\r\n\r\nrouterApi.post(`/${apiPath}/:id/PermissionScopes`, (req, res) => {\r\n  const data = { ...req.body, whenCreated: new Date(), status: \"New\" };\r\n  run(\r\n    res,\r\n    () =>\r\n      apiService.setData.apply(\r\n        apiService,\r\n        [data].concat([apiPath, req.params.id, \"PermissionScopes\", data.id])\r\n      ),\r\n    undefined,\r\n    undefined,\r\n    data\r\n  );\r\n});\r\n\r\nrouterApi.put(`/${apiPath}`, (req, res) => {\r\n  const data = { ...req.body, whenUpdated: new Date(), status: \"Updated\" };\r\n  run(res, () =>\r\n    apiService.updateData.apply(apiService, [data].concat([apiPath, data.id]))\r\n  );\r\n});\r\n\r\nrouterApi.put(`/${apiPath}/:id`, (req, res) => {\r\n  const data = { ...req.body, whenUpdated: new Date(), status: \"Updated\" };\r\n  run(res, () =>\r\n    apiService.updateData.apply(\r\n      apiService,\r\n      [data].concat([apiPath, req.params.id])\r\n    )\r\n  );\r\n});\r\n\r\nrouterApi.put(`/${apiPath}/:id/PermissionScopes/:scopeId`, (req, res) => {\r\n  const data = { ...req.body, whenUpdated: new Date(), status: \"Updated\" };\r\n  run(res, () =>\r\n    apiService.updateData.apply(\r\n      apiService,\r\n      [data].concat([apiPath, req.params.id, req.params.scopeId])\r\n    )\r\n  );\r\n});\r\n\r\nrouterApi.delete(`/${apiPath}/:id`, (req, res) => {\r\n  const data = {};\r\n  run(res, () =>\r\n    apiService.deleteData.apply(\r\n      apiService,\r\n      [data].concat([apiPath, req.params.id])\r\n    )\r\n  );\r\n});\r\n\r\nrouterApi.delete(`/${apiPath}/:id/PermissionScopes/:scopeId`, (req, res) => {\r\n  run(res, () =>\r\n    apiService.deleteData.apply(\r\n      apiService,\r\n      [null].concat([\r\n        apiPath,\r\n        req.params.id,\r\n        \"PermissionScopes\",\r\n        req.params.scopeId,\r\n      ])\r\n    )\r\n  );\r\n});\r\n\r\nrouterApi.delete(`/${apiPath}`, (req, res) => {\r\n  const data = [...req.body];\r\n  const allDeletes = data.map((item) => {\r\n    return apiService.deleteData.apply(\r\n      apiService,\r\n      [null].concat([apiPath, item.id])\r\n    );\r\n  });\r\n  run(res, () => Promise.all(allDeletes));\r\n});\r\n\r\n// common functions\r\nfunction run(response, fn, success, error, data) {\r\n  return fn()\r\n    .then((result) =>\r\n      response\r\n        .status(200)\r\n        .send(data ? data : success ? success(result) : result)\r\n    )\r\n    .catch((err) => {\r\n      console.error(err);\r\n      return response.status(500).send(error ? error(err) : err);\r\n    });\r\n}\r\n","module.exports = require(\"jwks-rsa\");","import { companyPath } from \"./remote-path-service.js\";\r\nimport { createService } from \"./service-factory.js\";\r\nimport { getDoc } from \"../firebase/firebase-service.js\";\r\n\r\nconst getChildCompanys = (id) => getDoc(companyPath(), [\"parent\", \"==\", id]);\r\n\r\nexport default { ...createService(companyPath), getChildCompanys };\r\n","import express from \"express\";\r\nimport companyService from \"../service/company-service.js\";\r\nimport { generateId } from \"../service/remote-path-service.js\";\r\n\r\nconst routerCompany = express.Router();\r\nexport default routerCompany;\r\n\r\nrouterCompany.get(`/`, (req, res) => {\r\n  run(res, () => companyService.getData(req.params.id));\r\n});\r\n\r\nrouterCompany.get(`/:id`, (req, res) => {\r\n  run(res, () => companyService.getData(req.params.id));\r\n});\r\n\r\nrouterCompany.get(`/:id/childCompanys`, (req, res) => {\r\n  run(res, () => companyService.getChildCompanys(req.params.id));\r\n});\r\n\r\nrouterCompany.post(\"/\", async (req, res) => {\r\n  const data = {\r\n    ...req.body,\r\n    id: generateId(req.body.name),\r\n    whenCreated: new Date(),\r\n    status: \"New\",\r\n  };\r\n\r\n  const company = await companyService.getData(data.id);\r\n  if (company.name) {\r\n    console.log(\"company exist\", company);\r\n    return res.status(409).send(\"Item exists\");\r\n  }\r\n\r\n  run(\r\n    res,\r\n    () =>\r\n      companyService.setData.apply(companyService, [data].concat([data.id])),\r\n    undefined,\r\n    undefined,\r\n    data\r\n  );\r\n});\r\n\r\nrouterCompany.put(\"/:id\", (req, res) => {\r\n  const data = { ...req.body, whenUpdated: new Date(), status: \"Updated\" };\r\n  run(res, () =>\r\n    companyService.updateData.apply(\r\n      companyService,\r\n      [data].concat([req.params.id])\r\n    )\r\n  );\r\n});\r\n\r\nrouterCompany.delete(`/:id`, (req, res) => {\r\n  const data = {};\r\n  //run(res, () => companyService.deleteData(req.params.id));\r\n  run(res, () =>\r\n    companyService.deleteData.apply(\r\n      companyService,\r\n      [data].concat([req.params.id])\r\n    )\r\n  );\r\n});\r\n\r\nrouterCompany.delete(`/`, (req, res) => {\r\n  const data = [...req.body];\r\n  const allDeletes = data.map((item) => {\r\n    return companyService.deleteData.apply(companyService, [item]);\r\n  });\r\n  run(res, () => Promise.all(allDeletes));\r\n});\r\n\r\n// common functions\r\nfunction run(response, fn, success, error, data) {\r\n  return fn()\r\n    .then((result) =>\r\n      response\r\n        .status(200)\r\n        .send(data ? data : success ? success(result) : result)\r\n    )\r\n    .catch((err) => {\r\n      console.error(err);\r\n      return response.status(500).send(error ? error(err) : err);\r\n    });\r\n}\r\n","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"firebase/compat/app\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"firebase-admin\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"firebase/compat/firestore\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"firebase/functions\");","import dotenv from \"dotenv\";\r\ndotenv.config();\r\n\r\nconst serviceAccount = {\r\n  type: process.env.FIREBASE_TYPE,\r\n  project_id: process.env.FIREBASE_PROJECT_ID,\r\n  private_key_id: process.env.FIREBASE_PRIVATE_KEY_ID,\r\n  private_key: process.env.FIREBASE_PRIVATE_KEY,\r\n  client_email: process.env.FIREBASE_CLIENT_EMAIL,\r\n  client_id: process.env.FIREBASE_CLIENT_ID,\r\n  auth_uri: process.env.FIREBASE_AUTH_URI,\r\n  token_uri: process.env.FIREBASE_TOKEN_URI,\r\n  auth_provider_x509_cert_url: process.env.FIREBASE_AUTH_PROVIDER_X509_CERT_URL,\r\n  client_x509_cert_url: process.env.FIREBASE_CLIENT_X509_CERT_URL,\r\n  universe_domain: process.env.FIREBASE_UNIVERSE_DOMAIN,\r\n};\r\n\r\nexport default serviceAccount;\r\n","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"blueimp-md5\");","import * as R from \"ramda\";\r\nimport firebase from \"firebase/compat/app\";\r\nimport \"firebase/compat/firestore\";\r\nimport admin from \"firebase-admin\";\r\nimport \"firebase/functions\";\r\nimport serviceAccount from \"./firebase-account.js\";\r\nimport md5 from \"blueimp-md5\";\r\n\r\nexport function init() {\r\n  firebase.initializeApp({\r\n    credential: admin.credential.cert(serviceAccount),\r\n    projectId: serviceAccount.project_id,\r\n  });\r\n}\r\n\r\nexport function login(user, password) {\r\n  return auth().signInWithEmailAndPassword(user, password);\r\n}\r\n\r\nexport function logout() {\r\n  return auth().signOut();\r\n}\r\n\r\nexport function auth() {\r\n  return firebase.auth();\r\n}\r\n\r\nexport function getAuthUser() {\r\n  return auth().currentUser;\r\n}\r\n\r\n// function isMultiDimensionalArray(arr) {\r\n//   // Check if the variable is an array\r\n//   if (Array.isArray(arr)) {\r\n//     // Check if any element of the array is also an array\r\n//     return arr.some((item) => Array.isArray(item));\r\n//   }\r\n//   return false; // Not an array\r\n// }\r\n\r\n// function applyConditions(query, conditions) {\r\n//   if (isMultiDimensionalArray(conditions)) {\r\n//     conditions.forEach(\r\n//       (condition) => (query = query.where.apply(query, condition))\r\n//     );\r\n//   } else {\r\n//     query = query.where.apply(query, conditions);\r\n//   }\r\n//   return query;\r\n// }\r\n\r\nexport async function getDoc(path, whereArgs) {\r\n  const [collectionPath, docName] = getCollectionPathAndDocId(path);\r\n  let ref = db().collection(collectionPath);\r\n\r\n  if (docName) {\r\n    return ref.doc(docName).get().then(toObject);\r\n  }\r\n\r\n  const applyAllWhereArgs = () => {\r\n    return whereArgs.reduce((acc, cur) => {\r\n      acc = acc.where.apply(acc, cur);\r\n      return acc;\r\n    }, ref);\r\n  };\r\n\r\n  const res =\r\n    whereArgs && whereArgs.length > 0\r\n      ? Array.isArray(whereArgs[0])\r\n        ? await applyAllWhereArgs().get()\r\n        : await ref.where.apply(ref, whereArgs).get()\r\n      : await ref.get();\r\n  return res.docs.map(toObject);\r\n}\r\n\r\nexport function getDocRef(path) {\r\n  return db().doc(path);\r\n}\r\n\r\nexport async function geChildtDoc(path) {\r\n  return await getDoc(path, null);\r\n}\r\n\r\nexport function getCollectionCount(path) {\r\n  return db()\r\n    .collection(path)\r\n    .get()\r\n    .then((res) => res.size);\r\n}\r\n\r\nexport async function getDownloadUrl(path) {\r\n  const ref = await getStorageRef(path);\r\n  const url = await ref.getDownloadURL();\r\n  return url;\r\n}\r\n\r\nexport async function upload(path, blob, metadata) {\r\n  const ref = await getStorageRef(path);\r\n  return await ref.put(blob, metadata);\r\n}\r\n\r\nexport async function uploadString(path, message, messageType) {\r\n  const ref = await getStorageRef(path);\r\n  return await ref.putString(message, messageType);\r\n}\r\n\r\nexport async function getStorageRef(path) {\r\n  return firebase.storage().ref(path);\r\n}\r\n\r\nexport function setDoc(path, data) {\r\n  return db().doc(path).set(data);\r\n}\r\n\r\nexport function addDoc(path, data) {\r\n  return db().collection(path).add(data);\r\n}\r\n\r\nexport function updateDoc(path, data) {\r\n  return db().doc(path).update(data);\r\n}\r\n\r\nexport function recursiveDeleteDoc(path) {\r\n  const deleteFn = firebase.functions().httpsCallable(\"recursiveDelete\");\r\n  return deleteFn({ path, currentUsers: getUid() });\r\n}\r\n\r\nexport function deleteDoc(path, id) {\r\n  const arr = path.split(\"/\");\r\n\r\n  if ((!id || R.isEmpty(id)) && isEven(arr.length)) {\r\n    path = R.init(arr).join(\"/\");\r\n    id = R.last(arr);\r\n  }\r\n  return db().collection(path).doc(id).delete();\r\n}\r\n\r\nexport async function verifyUser(path, password, whereArgs) {\r\n  const users = await getDoc(path, whereArgs);\r\n\r\n  if (users.length == 1) {\r\n    const user = users[0];\r\n\r\n    if (user.authVerification == md5(password)) return true;\r\n  }\r\n  return false;\r\n}\r\n\r\nfunction db() {\r\n  return firebase.firestore();\r\n}\r\n\r\nfunction getUid() {\r\n  return auth().currentUser.uid;\r\n}\r\n\r\nfunction isEven(num) {\r\n  return num % 2 === 0;\r\n}\r\n\r\nfunction toObject(fbReturn) {\r\n  return { id: fbReturn.id, ...fbReturn.data() };\r\n}\r\n\r\nfunction getCollectionPathAndDocId(path) {\r\n  const arr = path.split(\"/\");\r\n\r\n  if (isEven(arr.length)) {\r\n    return [R.init(arr).join(\"/\"), R.last(arr)];\r\n  }\r\n\r\n  return [path];\r\n}\r\n","module.exports = require(\"express-jwt\");","import * as R from \"ramda\";\r\nimport { getClient, getUser } from \"./auth_service.js\";\r\nimport codeService from \"../../service/code-service.js\";\r\n\r\nimport { buildUrl, getScopesFromForm } from \"../../helper/utils.js\";\r\nimport randomstring from \"randomstring\";\r\n\r\nasync function approve(req, res, routerAuth) {\r\n  const authId = \"authorization\";\r\n  const reqid = req.body.reqid;\r\n  const query = routerAuth.locals.requests[reqid];\r\n  delete routerAuth.locals.requests[reqid];\r\n\r\n  if (!query) {\r\n    // there was no matching saved request, this is an error\r\n    res.render(\"error\", { error: \"No matching authorization request\" });\r\n    return;\r\n  }\r\n\r\n  if (req.body.approve) {\r\n    if (query.response_type == \"code\") {\r\n      // user approved access\r\n\r\n      const rscope = getScopesFromForm(req.body);\r\n      const client = await getClient(query.client_id);\r\n      const user = await getUser(\r\n        client.companyId,\r\n        client.domain,\r\n        req.body.email\r\n      );\r\n\r\n      if (R.difference(rscope, client.scope).length > 0) {\r\n        const urlParsed = buildUrl(query.redirect_uri, {\r\n          error: \"invalid_scope\",\r\n        });\r\n        res.redirect(urlParsed);\r\n        return;\r\n      }\r\n\r\n      const code = randomstring.generate(8);\r\n\r\n      const data = {\r\n        request: query,\r\n        user: user,\r\n        scope: rscope,\r\n        whenCreated: new Date(),\r\n        status: \"issued\",\r\n      };\r\n\r\n      await codeService.setData.apply(\r\n        codeService,\r\n        [data].concat([authId, code])\r\n      );\r\n\r\n      const urlParsed = buildUrl(query.redirect_uri, {\r\n        code: code,\r\n        state: query.state,\r\n      });\r\n\r\n      res.redirect(urlParsed);\r\n      return;\r\n    } else {\r\n      // we got a response type we don't understand\r\n      const urlParsed = buildUrl(query.redirect_uri, {\r\n        error: \"unsupported_response_type\",\r\n      });\r\n      res.redirect(urlParsed);\r\n      return;\r\n    }\r\n  } else {\r\n    // user denied access\r\n    const urlParsed = buildUrl(query.redirect_uri, {\r\n      error: \"access_denied\",\r\n    });\r\n    res.redirect(urlParsed);\r\n    return;\r\n  }\r\n}\r\n\r\nexport default approve;\r\n","module.exports = require(\"dotenv\");","import { groupPath } from \"./remote-path-service.js\";\r\nimport { createService } from \"./service-factory.js\";\r\nimport { getDoc } from \"../firebase/firebase-service.js\";\r\n\r\nconst getGroupsWhere = (companyId, domainId, condition) =>\r\n  getDoc(groupPath(companyId, domainId), condition);\r\nconst getGroupMembers = (companyId, domainId, groupId) =>\r\n  getDoc(groupPath(companyId, domainId, groupId, \"members\"), null);\r\nexport default { ...createService(groupPath), getGroupsWhere, getGroupMembers };\r\n","import express from \"express\";\r\nimport groupService from \"../service/group-service.js\";\r\nimport {\r\n  DOMAIN_COLL,\r\n  GROUP_COLL,\r\n  generateId,\r\n} from \"../service/remote-path-service.js\";\r\n\r\nconst routerGroup = express.Router();\r\nconst memberPath = \"members\";\r\n\r\nexport default routerGroup;\r\n\r\nrouterGroup.get(`/:id/${DOMAIN_COLL}/:domainId/${GROUP_COLL}`, (req, res) => {\r\n  if (req.query.condition) {\r\n    run(res, () =>\r\n      groupService.getGroupsWhere(\r\n        req.params.id,\r\n        req.params.domainId,\r\n        req.query.condition\r\n      )\r\n    );\r\n  } else {\r\n    run(res, () => groupService.getData(req.params.id, req.params.domainId));\r\n  }\r\n});\r\n\r\nrouterGroup.get(\r\n  `/:id/${DOMAIN_COLL}/:domainId/${GROUP_COLL}/:groupId`,\r\n  (req, res) => {\r\n    run(res, () =>\r\n      groupService.getData(\r\n        req.params.id,\r\n        req.params.domainId,\r\n        req.params.groupId\r\n      )\r\n    );\r\n  }\r\n);\r\n\r\nrouterGroup.get(\r\n  `/:id/${DOMAIN_COLL}/:domainId/${GROUP_COLL}/:groupId/${memberPath}`,\r\n  (req, res) => {\r\n    run(res, () =>\r\n      groupService.getGroupMembers(\r\n        req.params.id,\r\n        req.params.domainId,\r\n        req.params.groupId\r\n      )\r\n    );\r\n  }\r\n);\r\n\r\nrouterGroup.post(\r\n  `/:id/${DOMAIN_COLL}/:domainId/${GROUP_COLL}`,\r\n  async (req, res) => {\r\n    const data = {\r\n      ...req.body,\r\n      id: generateId(req.body.name),\r\n      whenCreated: new Date(),\r\n      status: \"New\",\r\n    };\r\n\r\n    const group = await groupService.getData(\r\n      req.params.id,\r\n      req.params.domainId,\r\n      data.id\r\n    );\r\n    if (group.name) {\r\n      console.log(\"group exist\", group);\r\n      return res.status(409).send(\"Item exists\");\r\n    }\r\n\r\n    run(\r\n      res,\r\n      () =>\r\n        groupService.setData.apply(\r\n          groupService,\r\n          [data].concat([req.params.id, req.params.domainId, data.id])\r\n        ),\r\n      undefined,\r\n      undefined,\r\n      data\r\n    );\r\n  }\r\n);\r\n\r\nrouterGroup.post(\r\n  `/:id/${DOMAIN_COLL}/:domainId/${GROUP_COLL}/:groupId/${memberPath}`,\r\n  async (req, res) => {\r\n    if (Array.isArray(req.body)) {\r\n      const data = [...req.body];\r\n      const allAdds = data.map((itemTemp) => {\r\n        const item = {\r\n          ...itemTemp,\r\n          id: generateId(req.body.name),\r\n          whenCreated: new Date(),\r\n        };\r\n        return groupService.setData.apply(\r\n          groupService,\r\n          [{ ...item, whenCreated: new Date() }].concat([\r\n            req.params.id,\r\n            req.params.domainId,\r\n            req.params.groupId,\r\n            memberPath,\r\n            item.id,\r\n          ])\r\n        );\r\n      });\r\n      run(res, () => Promise.all(allAdds));\r\n    } else {\r\n      const data = {\r\n        ...req.body,\r\n        id: generateId(req.body.name),\r\n        whenCreated: new Date(),\r\n      };\r\n      run(\r\n        res,\r\n        () =>\r\n          groupService.setData.apply(\r\n            groupService,\r\n            [data].concat([\r\n              req.params.id,\r\n              req.params.domainId,\r\n              req.params.groupId,\r\n              memberPath,\r\n              data.id,\r\n            ])\r\n          ),\r\n        undefined,\r\n        undefined,\r\n        data\r\n      );\r\n    }\r\n  }\r\n);\r\n\r\nrouterGroup.put(\r\n  `/:id/${DOMAIN_COLL}/:domainId/${GROUP_COLL}/:groupId`,\r\n  (req, res) => {\r\n    const data = { ...req.body, whenUpdated: new Date() };\r\n    run(res, () =>\r\n      groupService.updateData.apply(\r\n        groupService,\r\n        [data].concat([req.params.id, req.params.domainId, req.params.groupId])\r\n      )\r\n    );\r\n  }\r\n);\r\n\r\nrouterGroup.put(`/:id/${DOMAIN_COLL}/:domainId/${GROUP_COLL}`, (req, res) => {\r\n  const data = [...req.body];\r\n  const allUpdates = data.map((item) => {\r\n    return groupService.updateData.apply(\r\n      groupService,\r\n      [{ ...item, whenUpdated: new Date() }].concat([\r\n        req.params.id,\r\n        req.params.domainId,\r\n        item.id,\r\n      ])\r\n    );\r\n  });\r\n  run(res, () => Promise.all(allUpdates));\r\n});\r\n\r\nrouterGroup.delete(\r\n  `/:id/${DOMAIN_COLL}/:domainId/${GROUP_COLL}/:groupId/${memberPath}/:memberId`,\r\n  (req, res) => {\r\n    run(res, () =>\r\n      groupService.deleteData.apply(\r\n        groupService,\r\n        [null].concat([\r\n          req.params.id,\r\n          req.params.domainId,\r\n          req.params.groupId,\r\n          memberPath,\r\n          req.params.memberId,\r\n        ])\r\n      )\r\n    );\r\n  }\r\n);\r\n\r\nrouterGroup.delete(\r\n  `/:id/${DOMAIN_COLL}/:domainId/${GROUP_COLL}/:groupId/${memberPath}`,\r\n  (req, res) => {\r\n    const data = [...req.body];\r\n    const allDeletes = data.map((item) => {\r\n      return groupService.deleteData.apply(\r\n        groupService,\r\n        [null].concat([\r\n          req.params.id,\r\n          req.params.domainId,\r\n          req.params.groupId,\r\n          memberPath,\r\n          item.id,\r\n        ])\r\n      );\r\n    });\r\n    run(res, () => Promise.all(allDeletes));\r\n  }\r\n);\r\n\r\nrouterGroup.delete(\r\n  `/:id/${DOMAIN_COLL}/:domainId/${GROUP_COLL}/:groupId`,\r\n  (req, res) => {\r\n    const data = { ...req.body };\r\n    run(res, () =>\r\n      groupService.deleteData.apply(\r\n        groupService,\r\n        [data].concat([req.params.id, req.params.domainId, req.params.groupId])\r\n      )\r\n    );\r\n  }\r\n);\r\n\r\nrouterGroup.delete(\r\n  `/:id/${DOMAIN_COLL}/:domainId/${GROUP_COLL}`,\r\n  (req, res) => {\r\n    const data = [...req.body];\r\n    const allDeletes = data.map((item) => {\r\n      return groupService.deleteData.apply(\r\n        groupService,\r\n        [null].concat([req.params.id, req.params.domainId, item.id])\r\n      );\r\n    });\r\n    run(res, () => Promise.all(allDeletes));\r\n  }\r\n);\r\n\r\n// common functions\r\nfunction run(response, fn, success, error, data) {\r\n  return fn()\r\n    .then((result) =>\r\n      response\r\n        .status(200)\r\n        .send(data ? data : success ? success(result) : result)\r\n    )\r\n    .catch((err) => {\r\n      console.error(err);\r\n      return response.status(500).send(error ? error(err) : err);\r\n    });\r\n}\r\n","import { buildUrl } from \"../../helper/utils.js\";\r\n\r\nasync function login(req, res, routerAuth) {\r\n  var authorizeUrl = buildUrl(routerAuth.locals.authorizationEndpoint, {\r\n    response_type: \"code\",\r\n    email: req.body.email,\r\n    password: req.body.password,\r\n    client_id: req.body.client_id,\r\n    redirect_uri: req.body.redirect_uri,\r\n    scope: req.body.scope,\r\n    state: req.body.state,\r\n  });\r\n\r\n  res.redirect(authorizeUrl);\r\n}\r\n\r\nexport default login;\r\n","module.exports = require(\"url\");","import express from \"express\";\r\nimport { init } from \"../firebase/firebase-service.js\";\r\nimport { authData } from \"./oauth/auth_service.js\";\r\nimport authorize from \"./oauth/authorize.js\";\r\nimport login from \"./oauth/login.js\";\r\nimport approve from \"./oauth/approve.js\";\r\nimport token from \"./oauth/token.js\";\r\n\r\nconst routerAuth = express.Router();\r\nexport default routerAuth;\r\n\r\ninit();\r\n\r\nconst authDataValue = await authData();\r\nconst authServer = {\r\n  authorizationEndpoint: authDataValue.authorizationEndpoint,\r\n  tokenEndpoint: authDataValue.tokenEndpoint,\r\n};\r\n\r\nconst requests = {};\r\nrouterAuth.locals = { ...authServer, requests };\r\nrouterAuth.get(\r\n  `/authorize`,\r\n  async (req, res) => await authorize(req, res, routerAuth)\r\n);\r\n\r\nrouterAuth.post(\r\n  \"/login\",\r\n  async (req, res) => await login(req, res, routerAuth)\r\n);\r\n\r\nrouterAuth.post(\r\n  \"/approve\",\r\n  async (req, res) => await approve(req, res, routerAuth)\r\n);\r\n\r\nrouterAuth.post(\r\n  \"/token\",\r\n  async (req, res) => await token(req, res, routerAuth)\r\n);\r\n","import {tokenPath} from './remote-path-service.js';\r\nimport {createService} from './service-factory.js';\r\n\r\nexport default createService(tokenPath);\r\n","import * as R from \"ramda\";\r\nimport {\r\n  decodeClientCredentials,\r\n  generateAccessToken,\r\n} from \"../../helper/utils.js\";\r\nimport { getClient } from \"./auth_service.js\";\r\nimport apiService from \"../../service/api-service.js\";\r\nimport tokenService from \"../../service/token-service.js\";\r\nimport codeService from \"../../service/code-service.js\";\r\nimport randomstring from \"randomstring\";\r\n\r\nasync function token(req, res, routerAuth) {\r\n  const authId = \"authorization\";\r\n  const apiId = \"api\";\r\n\r\n  const auth = req.headers[\"authorization\"];\r\n  let clientId = \"\";\r\n  let clientSecret = \"\";\r\n  if (auth) {\r\n    // check the auth header\r\n    const clientCredentials = decodeClientCredentials(auth);\r\n    //let { id: clientId, secret: clientSecret } = clientCredentials;\r\n    clientId = clientCredentials.id;\r\n    clientSecret = clientCredentials.secret;\r\n  }\r\n\r\n  // otherwise, check the post body\r\n  if (req.body.client_id) {\r\n    if (clientId) {\r\n      // if we've already seen the client's credentials in the authorization header, this is an error\r\n      console.log(\r\n        \"Client attempted to authenticate with multiple methods\",\r\n        routerAuth\r\n      );\r\n      res.status(401).json({ error: \"invalid_client\" });\r\n      return;\r\n    }\r\n    clientId = req.body.client_id;\r\n    clientSecret = req.body.client_secret;\r\n    //var { client_id: clientId, client_secret: clientSecret } = req.body;\r\n  }\r\n\r\n  const client = await getClient(clientId);\r\n  if (!client) {\r\n    console.log(\"Unknown client %s\", clientId);\r\n    res.status(401).json({ error: \"invalid_client\" });\r\n    return;\r\n  }\r\n\r\n  if (client.client_secret != clientSecret) {\r\n    console.log(\r\n      \"Mismatched client secret, expected %s got %s\",\r\n      client.client_secret,\r\n      clientSecret\r\n    );\r\n    res.status(401).json({ error: \"invalid_client\" });\r\n    return;\r\n  }\r\n\r\n  if (!R.includes(req.body.grant_type, client.grant_types)) {\r\n    console.log(\r\n      \"Mismatched grant_type %s does not exist in %s\",\r\n      req.body.grant_type,\r\n      client.grant_types.join(\",\")\r\n    );\r\n    res.status(401).json({ error: \"invalid_client_grant_type\" });\r\n    return;\r\n  }\r\n\r\n  if (req.body.grant_type == \"client_credentials\") {\r\n    const api = await apiService.getApiByIdentifier(apiId, client.audience);\r\n    if (api.length < 1) {\r\n      console.log(\r\n        \"Authence has not been found, expected %s got %s\",\r\n        clientId,\r\n        client.audience\r\n      );\r\n      res.status(400).json({ error: \"invalid_grant\" });\r\n      return;\r\n    }\r\n    const date = new Date();\r\n    const now_utc = Date.UTC(\r\n      date.getUTCFullYear(),\r\n      date.getUTCMonth(),\r\n      date.getUTCDate(),\r\n      date.getUTCHours(),\r\n      date.getUTCMinutes(),\r\n      date.getUTCSeconds()\r\n    );\r\n    const expires_in = Math.floor(now_utc / 1000) + api[0].tokenExpiration * 60;\r\n    console.log(\"token2\", now_utc, api, api[0].tokenExpiration);\r\n    const access_token = generateAccessToken(\r\n      \"http://oauth.unidir.igoodworks.com/\",\r\n      client.client_name,\r\n      api[0].identifier,\r\n      Math.floor(now_utc / 1000),\r\n      expires_in,\r\n      client.scope\r\n    );\r\n    //console.log(\"client_credentials Issuing access token %s\", access_token);\r\n    const tokenClient = {\r\n      client_id: clientId,\r\n      companyId: client.companyId,\r\n      domain: client.domain,\r\n    };\r\n    const token_response = {\r\n      access_token: access_token,\r\n      expires_in: expires_in,\r\n      client: tokenClient,\r\n      scope: client.scope,\r\n    };\r\n\r\n    res.status(200).json(token_response);\r\n    //console.log(\"client_credentials Issued tokens for code %s\", req.body);\r\n\r\n    return;\r\n  } else if (req.body.grant_type == \"authorization_code\") {\r\n    const code = await codeService.getData(authId, req.body.code);\r\n    if (code && code.request) {\r\n      await codeService.deleteData.apply(\r\n        codeService,\r\n        [{}].concat([authId, req.body.code])\r\n      );\r\n      //const api = await apiService.getApiByIdentifier.apply(apiService, [{}].concat([apiId, client.audience]));\r\n      const api = await apiService.getApiByIdentifier(apiId, client.audience);\r\n      if (api.length < 1) {\r\n        console.log(\r\n          \"Authence has not been found, expected %s got %s\",\r\n          clientId,\r\n          client.audience\r\n        );\r\n        res.status(400).json({ error: \"invalid_grant\" });\r\n        return;\r\n      }\r\n      if (code.request.client_id == clientId) {\r\n        const date = new Date();\r\n        const now_utc = Date.UTC(\r\n          date.getUTCFullYear(),\r\n          date.getUTCMonth(),\r\n          date.getUTCDate(),\r\n          date.getUTCHours(),\r\n          date.getUTCMinutes(),\r\n          date.getUTCSeconds()\r\n        );\r\n        const expires_in =\r\n          Math.floor(now_utc / 1000) + api[0].tokenExpiration * 60;\r\n        console.log(\"token2\", now_utc, api, api[0].tokenExpiration);\r\n        const access_token = generateAccessToken(\r\n          \"http://oauth.unidir.igoodworks.com/\",\r\n          client.client_name,\r\n          api[0].identifier,\r\n          Math.floor(now_utc / 1000),\r\n          expires_in,\r\n          client.scope\r\n        );\r\n        //console.log(\"Issuing access token %s\", access_token);\r\n        const tokenClient = {\r\n          client_id: clientId,\r\n          companyId: client.companyId,\r\n          domain: client.domain,\r\n        };\r\n        const token_response = {\r\n          access_token: access_token,\r\n          expires_in: expires_in,\r\n          client: tokenClient,\r\n          scope: code.scope,\r\n          user: code.user,\r\n        };\r\n\r\n        res.status(200).json(token_response);\r\n        //console.log(\"Issued tokens for code %s\", req.body.code);\r\n\r\n        return;\r\n      } else {\r\n        console.log(\r\n          \"Client mismatch, expected %s got %s\",\r\n          code.request.client_id,\r\n          clientId\r\n        );\r\n        res.status(400).json({ error: \"invalid_grant\" });\r\n        return;\r\n      }\r\n    } else {\r\n      console.log(\"Unknown code, %s\", req.body.code);\r\n      res.status(400).json({ error: \"invalid_grant\" });\r\n      return;\r\n    }\r\n  } else if (req.body.grant_type == \"refresh_token\") {\r\n    const token = await tokenService.getData(req.body.refresh_token);\r\n    if (token) {\r\n      console.log(\r\n        \"We found a matching refresh token: %s\",\r\n        req.body.refresh_token\r\n      );\r\n      if (token.client_id != clientId) {\r\n        tokenService.deleteData.apply(\r\n          tokenService,\r\n          [{}].concat([authId, req.body.refresh_token])\r\n        );\r\n        //nosql.remove().make(function(builder) { builder.where('refresh_token', req.body.refresh_token); });\r\n        res.status(400).json({ error: \"invalid_grant\" });\r\n        return;\r\n      }\r\n      const access_token = randomstring.generate();\r\n      // token_data = {\r\n      //   access_token: access_token,\r\n      //   client_id: clientId,\r\n      //   whenCreated: new Date(),\r\n      //   type: \"access_token\",\r\n      // };\r\n\r\n      const token_response = {\r\n        access_token: access_token,\r\n        token_type: \"Bearer\",\r\n        refresh_token: token.refresh_token,\r\n      };\r\n      res.status(200).json(token_response);\r\n      return;\r\n    } else {\r\n      console.log(\"No matching token was found.\");\r\n      res.status(400).json({ error: \"invalid_grant\" });\r\n      return;\r\n    }\r\n  } else {\r\n    console.log(\"Unknown grant type %s\", req.body.grant_type);\r\n    res.status(400).json({ error: \"unsupported_grant_type\" });\r\n  }\r\n}\r\n\r\nexport default token;\r\n","import { domainPath } from \"./remote-path-service.js\";\r\nimport { createService } from \"./service-factory.js\";\r\nimport { getDoc } from \"../firebase/firebase-service.js\";\r\n\r\nconst getDomainInfo = (companyId, domainId) =>\r\n  getDoc(domainPath(companyId, domainId), null);\r\nconst getPrimaryDomain = (companyId) =>\r\n  getDoc(domainPath(companyId), [\"primary\", \"==\", true]);\r\n\r\nexport default {\r\n  ...createService(domainPath),\r\n  getDomainInfo,\r\n  getPrimaryDomain,\r\n};\r\n","import express from \"express\";\r\nimport domainService from \"../service/domain-service.js\";\r\nimport { DOMAIN_COLL, generateId } from \"../service/remote-path-service.js\";\r\n\r\nconst routerDomain = express.Router();\r\nexport default routerDomain;\r\n\r\nrouterDomain.get(`/:id/${DOMAIN_COLL}/primary`, (req, res) => {\r\n  run(res, () => domainService.getPrimaryDomain(req.params.id));\r\n});\r\n\r\nrouterDomain.get(`/:id/${DOMAIN_COLL}/:domainId`, (req, res) => {\r\n  run(res, () =>\r\n    domainService.getDomainInfo(req.params.id, req.params.domainId)\r\n  );\r\n});\r\n\r\nrouterDomain.get(`/:id/${DOMAIN_COLL}`, (req, res) => {\r\n  run(res, () => domainService.getData(req.params.id));\r\n});\r\n\r\nrouterDomain.post(`/:id/${DOMAIN_COLL}`, async (req, res) => {\r\n  const data = {\r\n    ...req.body,\r\n    id: generateId(req.body.name),\r\n    whenCreated: new Date(),\r\n    status: \"New\",\r\n  };\r\n  const domain = await domainService.getDomainInfo(req.params.id, data.id);\r\n  if (domain.name) {\r\n    return res.status(409).send(\"Item exists\");\r\n  }\r\n  run(\r\n    res,\r\n    () =>\r\n      domainService.setData.apply(\r\n        domainService,\r\n        [data].concat([req.params.id, data.id])\r\n      ),\r\n    undefined,\r\n    undefined,\r\n    data\r\n  );\r\n});\r\n\r\nrouterDomain.put(`/:id/${DOMAIN_COLL}/:domainId`, (req, res) => {\r\n  const data = { ...req.body, whenUpdated: new Date(), status: \"Updated\" };\r\n  run(res, () =>\r\n    domainService.updateData.apply(\r\n      domainService,\r\n      [data].concat([req.params.id, req.params.domainId])\r\n    )\r\n  );\r\n});\r\n\r\nrouterDomain.put(`/:id/${DOMAIN_COLL}`, (req, res) => {\r\n  const data = req.body;\r\n  const allDomains = data.map((item) => {\r\n    return domainService.updateData.apply(\r\n      domainService,\r\n      [{ ...item, whenUpdated: new Date(), status: \"Updated\" }].concat([\r\n        req.params.id,\r\n        item.id,\r\n      ])\r\n    );\r\n  });\r\n\r\n  run(res, () => Promise.all(allDomains));\r\n});\r\n\r\nrouterDomain.delete(`/:id/${DOMAIN_COLL}/:domainId`, (req, res) => {\r\n  const data = {};\r\n  run(res, () =>\r\n    domainService.deleteData.apply(\r\n      domainService,\r\n      [data].concat([req.params.id, req.params.domainId])\r\n    )\r\n  );\r\n});\r\n\r\nrouterDomain.delete(`/:id/${DOMAIN_COLL}`, (req, res) => {\r\n  const data = [...req.body];\r\n  const allDeletes = data.map((item) => {\r\n    return domainService.deleteData.apply(\r\n      domainService,\r\n      [null].concat([req.params.id, item.id])\r\n    );\r\n  });\r\n  run(res, () => Promise.all(allDeletes));\r\n});\r\n\r\n// common functions\r\nfunction run(response, fn, success, error, data) {\r\n  return fn()\r\n    .then((result) =>\r\n      response\r\n        .status(200)\r\n        .send(data ? data : success ? success(result) : result)\r\n    )\r\n    .catch((err) => {\r\n      console.error(err);\r\n      return response.status(500).send(error ? error(err) : err);\r\n    });\r\n}\r\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// startup\n// Load entry module and return exports\n// This entry module used 'module' so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(257);\n"],"names":["webpackQueues","webpackExports","webpackError","resolveQueue","routerApplication","appPath","run","response","fn","success","error","data","then","result","status","send","catch","err","console","get","req","res","query","condition","getApplicationsWhere","getData","params","id","companyId","getApplications","domainId","post","body","client_id_created_at","Date","client_status","setData","apply","concat","client_id","undefined","put","whenUpdated","updateData","delete","deleteData","allDeletes","map","item","Promise","all","module","exports","require","routerProvisioning","provisioningId","async","name","whenCreated","provisioning","log","generateAccessToken","iss","sub","aud","iat","exp","permissions","header","payload","jti","privateKey","getKey","JWS","sign","alg","JSON","stringify","buildUrl","base","options","hash","newUrl","search","value","key","decodeClientCredentials","auth","clientCredentials","Buffer","from","slice","toString","split","secret","getScopesFromForm","s","createService","pathFn","getPath","getChildData","getDataCount","ids","addData","getDataByPath","dataPath","setDataByPath","deleteDataByPath","isProduction","__filename","fileURLToPath","__dirname","oauth_server_path","app","Guard","requestProperty","permissionsProperty","jwtCheck","expressjwt","cache","rateLimit","jwksRequestsPerMinute","jwksUri","audience","issuer","algorithms","use","extended","engine","set","check","sendFile","hostheader","port","process","env","SERVER_PORT","server","listen","host","address","getRedirectURIs","authId","appid","fullCondition","routerUser","getUsersWhere","userId","username","user","allUpdates","arrayBufferToHex","buffer","Uint8Array","byte","padStart","join","buildQueryUrl","baseUrl","encripedParams","text","password","encoder","TextEncoder","salt","crypto","getRandomValues","iv","keyMaterial","encode","subtle","importKey","getCryptoKey","deriveKey","iterations","length","cipherText","encrypt","encryptText","ENCRIPTION_PASSWORD","routerAuth","client","scope","email","redirect_uri","state","redirectURL","redirect","domain","redirect_uris","rscope","urlParsed","reqid","locals","requests","render","getApis","apiPartialPath","getApisWhere","getApiPermissionScopes","apiId","getApiByIdentifier","identifier","COMPANY_COLL","DOMAIN_COLL","GROUP_COLL","USER_COLL","PROVISIONING_COLL","CONNECTION_COLL","param","reduce","acc","cur","companyPath","domainPath","groupPath","groupId","memberPath","memberId","userPath","provisioningPath","connectionPath","connectionId","authPath","apiPath","scopePath","scopeId","applicationPath","appId","authCodePath","codeId","tokenPath","token","generateId","reg","RegExp","URL","createObjectURL","Blob","replace","authData","getUser","domainName","users","getUserByEmail","verifyUser","userVerification","getClient","clientId","appData","routerConnection","enabled","connection","routerApi","getChildCompanys","routerCompany","company","type","FIREBASE_TYPE","project_id","FIREBASE_PROJECT_ID","private_key_id","FIREBASE_PRIVATE_KEY_ID","private_key","FIREBASE_PRIVATE_KEY","client_email","FIREBASE_CLIENT_EMAIL","FIREBASE_CLIENT_ID","auth_uri","FIREBASE_AUTH_URI","token_uri","FIREBASE_TOKEN_URI","auth_provider_x509_cert_url","FIREBASE_AUTH_PROVIDER_X509_CERT_URL","client_x509_cert_url","FIREBASE_CLIENT_X509_CERT_URL","universe_domain","FIREBASE_UNIVERSE_DOMAIN","init","credential","cert","projectId","getDoc","path","whereArgs","collectionPath","docName","arr","isEven","getCollectionPathAndDocId","ref","db","collection","doc","toObject","Array","isArray","where","docs","geChildtDoc","getCollectionCount","size","setDoc","addDoc","add","updateDoc","update","deleteDoc","authVerification","num","fbReturn","approve","response_type","code","request","getGroupsWhere","getGroupMembers","routerGroup","group","allAdds","itemTemp","authorizeUrl","authorizationEndpoint","authDataValue","authServer","tokenEndpoint","headers","clientSecret","json","client_secret","grant_type","grant_types","api","date","now_utc","UTC","getUTCFullYear","getUTCMonth","getUTCDate","getUTCHours","getUTCMinutes","getUTCSeconds","expires_in","Math","floor","tokenExpiration","token_response","access_token","client_name","refresh_token","token_type","getDomainInfo","getPrimaryDomain","routerDomain","allDomains","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","Symbol","queue","d","forEach","r","a","hasAwait","currentDeps","outerResolve","reject","depQueues","Set","promise","resolve","rej","x","deps","dep","obj","e","ret","wrapDeps","getResult","fnQueue","q","has","push","definition","o","Object","defineProperty","enumerable","prop","prototype","hasOwnProperty","call","__webpack_exports__"],"sourceRoot":""}